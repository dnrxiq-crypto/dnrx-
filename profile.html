<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ - Ù†Ø¸Ø§Ù… DNRX</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: Arial, sans-serif;
      padding: 16px;
      background: #fff;
      color: #000;
      line-height: 1.5;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    
    .container {
      max-width: 500px;
      width: 100%;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 2px solid #000;
    }
    
    h1 {
      font-size: 24px;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .subtitle {
      color: #666;
      font-size: 14px;
    }
    
    .profile-card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 20px;
    }
    
    .profile-header {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      margin-bottom: 24px;
      padding-bottom: 20px;
      border-bottom: 1px solid #eee;
    }
    
    .profile-avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
      font-size: 40px;
      color: #666;
      border: 3px solid #000;
      overflow: hidden;
    }
    
    .profile-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .profile-name {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .profile-email {
      color: #666;
      font-size: 14px;
    }
    
    .form-group {
      margin-bottom: 18px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    input, select {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      font-size: 15px;
      border-radius: 6px;
      background: #fff;
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: #000;
    }
    
    input:read-only {
      background: #f9f9f9;
      cursor: not-allowed;
    }
    
    .save-btn {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      background: #000;
      color: #fff;
      margin-top: 10px;
      transition: all 0.2s;
    }
    
    .save-btn:hover {
      background: #333;
    }
    
    .save-btn:disabled {
      background: #666;
      cursor: not-allowed;
    }
    
    .back-btn {
      width: 100%;
      padding: 14px;
      border: 1px solid #000;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      background: #fff;
      color: #000;
      margin-top: 10px;
      transition: all 0.2s;
    }
    
    .back-btn:hover {
      background: #f5f5f5;
    }
    
    .message {
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 16px;
      text-align: center;
      font-size: 13px;
      display: none;
    }
    
    .success {
      background: #e8f5e9;
      color: #2e7d32;
      border: 1px solid #c8e6c9;
    }
    
    .error {
      background: #ffebee;
      color: #c62828;
      border: 1px solid #ffcdd2;
    }
    
    .info {
      background: #e3f2fd;
      color: #1565c0;
      border: 1px solid #bbdefb;
    }
    
    .profile-status {
      text-align: center;
      margin-top: 10px;
      padding: 10px;
      border-radius: 6px;
      font-size: 13px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .status-approved {
      background: #e8f5e9;
      color: #2e7d32;
    }
    
    .status-pending {
      background: #fff3e0;
      color: #f57c00;
    }
    
    footer {
      text-align: center;
      margin-top: 25px;
      padding-top: 15px;
      border-top: 1px solid #ddd;
      color: #666;
      font-size: 12px;
    }
    
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @media (max-width: 480px) {
      body {
        padding: 12px;
      }
      
      .profile-card {
        padding: 18px;
      }
      
      h1 {
        font-size: 20px;
      }
      
      .profile-avatar {
        width: 80px;
        height: 80px;
        font-size: 30px;
      }
    }
    
    .date-input-group {
      display: flex;
      gap: 10px;
    }
    
    .date-input-group select {
      flex: 1;
    }
    
    .phone-group {
      display: flex;
      gap: 10px;
    }
    
    .phone-group .phone-code {
      width: 120px;
      flex-shrink: 0;
    }
    
    .phone-group .phone-number {
      flex: 1;
    }
    
    .form-section {
      margin-bottom: 24px;
      padding-bottom: 20px;
      border-bottom: 1px solid #eee;
    }
    
    .section-title {
      font-size: 16px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .read-only-field {
      background: #f9f9f9;
      border: 1px solid #eee;
      padding: 12px;
      border-radius: 6px;
      font-size: 14px;
    }
    
    .read-only-value {
      font-weight: bold;
      margin-top: 5px;
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-user-circle"></i> Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h1>
      <p class="subtitle">Ø§ÙƒÙ…Ù„ Ø£Ùˆ Ø¹Ø¯Ù‘Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠ</p>
    </header>
    
    <div class="profile-card">
      <div id="message" class="message"></div>
      
      <div class="profile-header">
        <div class="profile-avatar" id="userAvatar">
          <i class="fas fa-user"></i>
        </div>
        <div class="profile-name" id="userName">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        <div class="profile-email" id="userEmail">...</div>
        <div class="profile-status status-pending" id="profileStatus" style="display: none;">
          <i class="fas fa-clock"></i> ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
        </div>
      </div>
      
      <div class="form-section">
        <h3 class="section-title"><i class="fas fa-user"></i> Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>
        
        <div class="form-group">
          <label for="fullName">
            <i class="fas fa-user"></i> Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *
          </label>
          <input 
            type="text" 
            id="fullName" 
            placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„"
            required
          >
        </div>
        
        <div class="form-group">
          <label for="birthDate">
            <i class="fas fa-birthday-cake"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ *
          </label>
          <div class="date-input-group">
            <select id="birthDay">
              <option value="">Ø§Ù„ÙŠÙˆÙ…</option>
              <script>
                for(let i = 1; i <= 31; i++) {
                  document.write(`<option value="${i}">${i}</option>`);
                }
              </script>
            </select>
            <select id="birthMonth">
              <option value="">Ø§Ù„Ø´Ù‡Ø±</option>
              <option value="1">ÙŠÙ†Ø§ÙŠØ±</option>
              <option value="2">ÙØ¨Ø±Ø§ÙŠØ±</option>
              <option value="3">Ù…Ø§Ø±Ø³</option>
              <option value="4">Ø£Ø¨Ø±ÙŠÙ„</option>
              <option value="5">Ù…Ø§ÙŠÙˆ</option>
              <option value="6">ÙŠÙˆÙ†ÙŠÙˆ</option>
              <option value="7">ÙŠÙˆÙ„ÙŠÙˆ</option>
              <option value="8">Ø£ØºØ³Ø·Ø³</option>
              <option value="9">Ø³Ø¨ØªÙ…Ø¨Ø±</option>
              <option value="10">Ø£ÙƒØªÙˆØ¨Ø±</option>
              <option value="11">Ù†ÙˆÙÙ…Ø¨Ø±</option>
              <option value="12">Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
            </select>
            <select id="birthYear">
              <option value="">Ø§Ù„Ø³Ù†Ø©</option>
              <script>
                const currentYear = new Date().getFullYear();
                for(let i = currentYear; i >= 1950; i--) {
                  document.write(`<option value="${i}">${i}</option>`);
                }
              </script>
            </select>
          </div>
        </div>
        
        <div class="form-group">
          <label for="phone">
            <i class="fas fa-phone"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *
          </label>
          <div class="phone-group">
            <select id="phoneCode" class="phone-code">
              <option value="+966">+966</option>
            </select>
            <input 
              type="tel" 
              id="phone" 
              class="phone-number"
              placeholder="5xxxxxxxx"
              required
            >
          </div>
        </div>
      </div>
      
      <div class="form-section">
        <h3 class="section-title"><i class="fas fa-store"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</h3>
        
        <div class="form-group">
          <label for="storeName">
            <i class="fas fa-store"></i> Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø± *
          </label>
          <input 
            type="text" 
            id="storeName" 
            placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ù…ØªØ¬Ø±Ùƒ"
            required
          >
        </div>
        
        <div class="form-group">
          <label for="storeType">
            <i class="fas fa-tags"></i> Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­Ù„ *
          </label>
          <select id="storeType" required>
            <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­Ù„</option>
            <option value="grocery">Ø¨Ù‚Ø§Ù„Ø© ÙˆØ³ÙˆØ¨Ø±Ù…Ø§Ø±ÙƒØª</option>
            <option value="clothing">Ù…Ù„Ø§Ø¨Ø³ ÙˆØ£Ø²ÙŠØ§Ø¡</option>
            <option value="electronics">Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª ÙˆØ£Ø¬Ù‡Ø²Ø©</option>
            <option value="pharmacy">ØµÙŠØ¯Ù„ÙŠØ©</option>
            <option value="restaurant">Ù…Ø·Ø¹Ù… ÙˆÙƒØ§ÙÙŠÙ‡</option>
            <option value="jewelry">Ù…Ø¬ÙˆÙ‡Ø±Ø§Øª ÙˆØ³Ø§Ø¹Ø§Øª</option>
            <option value="furniture">Ø£Ø«Ø§Ø« ÙˆÙ…Ù†Ø²Ù„</option>
            <option value="sports">Ø±ÙŠØ§Ø¶Ø© ÙˆÙ…Ø³ØªÙ„Ø²Ù…Ø§Øª</option>
            <option value="beauty">ØªØ¬Ù…ÙŠÙ„ ÙˆØ¹Ù†Ø§ÙŠØ©</option>
            <option value="books">ÙƒØªØ¨ ÙˆÙ…Ø³ØªÙ„Ø²Ù…Ø§Øª</option>
            <option value="other">Ø£Ø®Ø±Ù‰</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="country">
            <i class="fas fa-globe"></i> Ø§Ù„Ø¯ÙˆÙ„Ø© *
          </label>
          <select id="country" class="country-select" required>
            <option value="">Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¯ÙˆÙ„Ø©...</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="city">
            <i class="fas fa-city"></i> Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© *
          </label>
          <select id="city" class="city-select" required>
            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆÙ„Ø© Ø£ÙˆÙ„Ø§Ù‹</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="currency">
            <i class="fas fa-money-bill-wave"></i> Ø§Ù„Ø¹Ù…Ù„Ø© *
          </label>
          <select id="currency" class="currency-select" required>
            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…Ù„Ø©...</option>
          </select>
        </div>
      </div>
      
      <div class="form-section">
        <h3 class="section-title"><i class="fas fa-info-circle"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
        
        <div class="form-group">
          <div class="read-only-field">
            <div style="color: #666; font-size: 12px;">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</div>
            <div class="read-only-value" id="displayEmail">...</div>
          </div>
        </div>
        
        <div class="form-group">
          <div class="read-only-field">
            <div style="color: #666; font-size: 12px;">Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</div>
            <div class="read-only-value" id="userId">...</div>
          </div>
        </div>
        
        <div class="form-group">
          <div class="read-only-field">
            <div style="color: #666; font-size: 12px;">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</div>
            <div class="read-only-value" id="createdAt">...</div>
          </div>
        </div>
      </div>
      
      <button class="save-btn" id="saveBtn">
        <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
      </button>
      
      <button class="back-btn" onclick="location.href='main.html'">
        <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
      </button>
    </div>
    
    <footer>
      <p>Ù†Ø¸Ø§Ù… DNRX - Ø§Ù„Ø¥ØµØ¯Ø§Ø± 1.0 | ØµÙØ­Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</p>
    </footer>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script type="module">
    // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-auth.js";
    import { 
      getFirestore, 
      doc, 
      getDoc,
      updateDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js";

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAG4EKrB3iLEV2hsB8b08ShpSO6PXDnGjg",
      authDomain: "zio3-8ffdd.firebaseapp.com",
      databaseURL: "https://zio3-8ffdd-default-rtdb.firebaseio.com",
      projectId: "zio3-8ffdd",
      storageBucket: "zio3-8ffdd.firebasestorage.app",
      messagingSenderId: "560939348415",
      appId: "1:560939348415:web:c854e9e214e498ad2d310a",
      measurementId: "G-CVN2B2D0RD"
    };
    
    // ØªÙ‡ÙŠØ¦Ø© Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    
    const ADMIN_EMAIL = 'ashlhl.iq@gmail.com';
    
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙˆÙ„ Ù…Ø¹ Ø±Ù…Ø² Ø§Ù„Ù‡Ø§ØªÙ ÙˆØ§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    const countries = [
      {id: 'SA', name: 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©', phoneCode: '+966', currency: 'SAR'},
      {id: 'AE', name: 'Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª', phoneCode: '+971', currency: 'AED'},
      {id: 'QA', name: 'Ù‚Ø·Ø±', phoneCode: '+974', currency: 'QAR'},
      {id: 'KW', name: 'Ø§Ù„ÙƒÙˆÙŠØª', phoneCode: '+965', currency: 'KWD'},
      {id: 'BH', name: 'Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†', phoneCode: '+973', currency: 'BHD'},
      {id: 'OM', name: 'Ø¹ÙÙ…Ø§Ù†', phoneCode: '+968', currency: 'OMR'},
      {id: 'JO', name: 'Ø§Ù„Ø£Ø±Ø¯Ù†', phoneCode: '+962', currency: 'JOD'},
      {id: 'LB', name: 'Ù„Ø¨Ù†Ø§Ù†', phoneCode: '+961', currency: 'LBP'},
      {id: 'EG', name: 'Ù…ØµØ±', phoneCode: '+20', currency: 'EGP'},
      {id: 'MA', name: 'Ø§Ù„Ù…ØºØ±Ø¨', phoneCode: '+212', currency: 'MAD'},
      {id: 'TN', name: 'ØªÙˆÙ†Ø³', phoneCode: '+216', currency: 'TND'},
      {id: 'DZ', name: 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±', phoneCode: '+213', currency: 'DZD'},
      {id: 'IQ', name: 'Ø§Ù„Ø¹Ø±Ø§Ù‚', phoneCode: '+964', currency: 'IQD'},
      {id: 'SY', name: 'Ø³ÙˆØ±ÙŠØ§', phoneCode: '+963', currency: 'SYP'},
      {id: 'YE', name: 'Ø§Ù„ÙŠÙ…Ù†', phoneCode: '+967', currency: 'YER'},
      {id: 'SD', name: 'Ø§Ù„Ø³ÙˆØ¯Ø§Ù†', phoneCode: '+249', currency: 'SDG'},
      {id: 'LY', name: 'Ù„ÙŠØ¨ÙŠØ§', phoneCode: '+218', currency: 'LYD'},
      {id: 'US', name: 'Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ù…ØªØ­Ø¯Ø©', phoneCode: '+1', currency: 'USD'},
      {id: 'GB', name: 'Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù…ØªØ­Ø¯Ø©', phoneCode: '+44', currency: 'GBP'},
      {id: 'CA', name: 'ÙƒÙ†Ø¯Ø§', phoneCode: '+1', currency: 'CAD'},
      {id: 'AU', name: 'Ø£Ø³ØªØ±Ø§Ù„ÙŠØ§', phoneCode: '+61', currency: 'AUD'},
      {id: 'FR', name: 'ÙØ±Ù†Ø³Ø§', phoneCode: '+33', currency: 'EUR'},
      {id: 'DE', name: 'Ø£Ù„Ù…Ø§Ù†ÙŠØ§', phoneCode: '+49', currency: 'EUR'},
      {id: 'IT', name: 'Ø¥ÙŠØ·Ø§Ù„ÙŠØ§', phoneCode: '+39', currency: 'EUR'},
      {id: 'ES', name: 'Ø¥Ø³Ø¨Ø§Ù†ÙŠØ§', phoneCode: '+34', currency: 'EUR'},
      {id: 'TR', name: 'ØªØ±ÙƒÙŠØ§', phoneCode: '+90', currency: 'TRY'},
      {id: 'IN', name: 'Ø§Ù„Ù‡Ù†Ø¯', phoneCode: '+91', currency: 'INR'},
      {id: 'CN', name: 'Ø§Ù„ØµÙŠÙ†', phoneCode: '+86', currency: 'CNY'},
      {id: 'JP', name: 'Ø§Ù„ÙŠØ§Ø¨Ø§Ù†', phoneCode: '+81', currency: 'JPY'},
      {id: 'KR', name: 'ÙƒÙˆØ±ÙŠØ§ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©', phoneCode: '+82', currency: 'KRW'},
      {id: 'RU', name: 'Ø±ÙˆØ³ÙŠØ§', phoneCode: '+7', currency: 'RUB'},
      {id: 'BR', name: 'Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„', phoneCode: '+55', currency: 'BRL'}
    ];
    
    // Ø§Ù„Ù…Ø¯Ù† Ù„ÙƒÙ„ Ø¯ÙˆÙ„Ø©
    const citiesByCountry = {
      'SA': ['Ø§Ù„Ø±ÙŠØ§Ø¶', 'Ø¬Ø¯Ø©', 'Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©', 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©', 'Ø§Ù„Ø¯Ù…Ø§Ù…', 'Ø§Ù„Ø®Ø¨Ø±', 'Ø§Ù„Ø·Ø§Ø¦Ù', 'ØªØ¨ÙˆÙƒ', 'Ø¨Ø±ÙŠØ¯Ø©', 'Ø®Ù…ÙŠØ³ Ù…Ø´ÙŠØ·', 'Ø­Ø§Ø¦Ù„', 'Ø¬Ø§Ø²Ø§Ù†', 'Ù†Ø¬Ø±Ø§Ù†', 'ÙŠÙ†Ø¨Ø¹', 'Ø£Ø¨Ù‡Ø§'],
      'AE': ['Ø£Ø¨Ùˆ Ø¸Ø¨ÙŠ', 'Ø¯Ø¨ÙŠ', 'Ø§Ù„Ø´Ø§Ø±Ù‚Ø©', 'Ø¹Ø¬Ù…Ø§Ù†', 'Ø£Ù… Ø§Ù„Ù‚ÙŠÙˆÙŠÙ†', 'Ø±Ø£Ø³ Ø§Ù„Ø®ÙŠÙ…Ø©', 'Ø§Ù„ÙØ¬ÙŠØ±Ø©', 'Ø§Ù„Ø¹ÙŠÙ†'],
      'QA': ['Ø§Ù„Ø¯ÙˆØ­Ø©', 'Ø§Ù„Ø±ÙŠØ§Ù†', 'Ø£Ù… ØµÙ„Ø§Ù„', 'Ø§Ù„Ø®ÙˆØ±', 'Ø§Ù„ÙˆÙƒØ±Ø©', 'Ø§Ù„Ø´Ù…Ø§Ù„', 'Ø§Ù„Ø¬Ù…ÙŠÙ„ÙŠØ©'],
      'KW': ['Ø§Ù„ÙƒÙˆÙŠØª', 'Ø­ÙˆÙ„ÙŠ', 'Ø§Ù„ÙØ±ÙˆØ§Ù†ÙŠØ©', 'Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠ', 'Ø§Ù„Ø¬Ù‡Ø±Ø§Ø¡', 'Ù…Ø¨Ø§Ø±Ùƒ Ø§Ù„ÙƒØ¨ÙŠØ±'],
      'BH': ['Ø§Ù„Ù…Ù†Ø§Ù…Ø©', 'Ø§Ù„Ù…Ø­Ø±Ù‚', 'Ø§Ù„Ø±ÙØ§Ø¹', 'Ø­Ø¯Ø§Ø¦Ù‚ Ø§Ù„Ø­ÙˆØ±Ø©', 'Ù…Ø¯ÙŠÙ†Ø© Ø¹ÙŠØ³Ù‰', 'Ø³ØªØ±Ø©', 'Ø§Ù„Ø¯Ø±Ø§Ø²'],
      'OM': ['Ù…Ø³Ù‚Ø·', 'ØµÙ„Ø§Ù„Ø©', 'ØµÙˆØ±', 'Ù†Ø²ÙˆÙ‰', 'ØµØ­Ø§Ø±', 'Ø§Ù„Ø±Ø³ØªØ§Ù‚', 'Ø§Ù„Ø¨Ø±ÙŠÙ…ÙŠ'],
      'JO': ['Ø¹Ù…Ø§Ù†', 'Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡', 'Ø¥Ø±Ø¨Ø¯', 'Ø§Ù„Ø¹Ù‚Ø¨Ø©', 'Ø§Ù„ÙƒØ±Ùƒ', 'Ù…Ø¹Ø§Ù†', 'Ù…Ø§Ø¯Ø¨Ø§', 'Ø§Ù„Ø³Ù„Ø·'],
      'LB': ['Ø¨ÙŠØ±ÙˆØª', 'Ø·Ø±Ø§Ø¨Ù„Ø³', 'ØµÙŠØ¯Ø§', 'ØµÙˆØ±', 'Ø²Ø­Ù„Ø©', 'Ø¬ÙˆÙ†ÙŠÙ‡', 'Ø¨Ø¹Ø¨Ø¯Ø§'],
      'EG': ['Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©', 'Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©', 'Ø§Ù„Ø¬ÙŠØ²Ø©', 'Ø´Ø±Ù… Ø§Ù„Ø´ÙŠØ®', 'Ø§Ù„Ø£Ù‚ØµØ±', 'Ø£Ø³ÙˆØ§Ù†', 'Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯', 'Ø§Ù„Ø³ÙˆÙŠØ³', 'Ø¯Ù…ÙŠØ§Ø·', 'Ø§Ù„Ù…Ù†ØµÙˆØ±Ø©', 'Ø·Ù†Ø·Ø§', 'Ø§Ù„ÙÙŠÙˆÙ…', 'Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ', 'Ø§Ù„Ù…Ù†ÙŠØ§', 'Ø³ÙˆÙ‡Ø§Ø¬', 'Ù‚Ù†Ø§', 'Ø£Ø³ÙŠÙˆØ·'],
      'IQ': ['Ø¨ØºØ¯Ø§Ø¯', 'Ø§Ù„Ø¨ØµØ±Ø©', 'Ø§Ù„Ù…ÙˆØµÙ„', 'Ø£Ø±Ø¨ÙŠÙ„', 'Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©', 'ÙƒØ±ÙƒÙˆÙƒ', 'Ø§Ù„Ù†Ø§ØµØ±ÙŠØ©', 'Ø§Ù„Ø¹Ù…Ø§Ø±Ø©', 'Ø§Ù„Ø­Ù„Ø©', 'Ø§Ù„ÙƒÙˆØª', 'Ø°ÙŠ Ù‚Ø§Ø±', 'Ø¨Ø§Ø¨Ù„', 'Ø§Ù„Ù†Ø¬Ù', 'ÙƒØ±Ø¨Ù„Ø§Ø¡', 'Ø§Ù„Ø£Ù†Ø¨Ø§Ø±', 'Ø¯ÙŠØ§Ù„Ù‰', 'ÙˆØ§Ø³Ø·', 'Ù…ÙŠØ³Ø§Ù†'],
      'SY': ['Ø¯Ù…Ø´Ù‚', 'Ø­Ù„Ø¨', 'Ø­Ù…Øµ', 'Ø§Ù„Ù„Ø§Ø°Ù‚ÙŠØ©', 'Ø­Ù…Ø§Ø©', 'Ø·Ø±Ø·ÙˆØ³', 'Ø¯ÙŠØ± Ø§Ù„Ø²ÙˆØ±', 'Ø§Ù„Ø³ÙˆÙŠØ¯Ø§Ø¡', 'Ø§Ù„Ø­Ø³ÙƒØ©', 'Ø§Ù„Ø±Ù‚Ø©', 'Ø¥Ø¯Ù„Ø¨'],
      'YE': ['ØµÙ†Ø¹Ø§Ø¡', 'Ø¹Ø¯Ù†', 'ØªØ¹Ø²', 'Ø§Ù„Ø­Ø¯ÙŠØ¯Ø©', 'Ø¥Ø¨', 'Ø°Ù…Ø§Ø±', 'Ø§Ù„Ù…ÙƒÙ„Ø§', 'Ø³ÙŠØ¦ÙˆÙ†', 'Ø´Ø¨ÙˆÙ‡', 'Ø­Ø¬Ø©', 'Ù…Ø£Ø±Ø¨', 'Ø§Ù„Ø¬ÙˆÙ', 'Ø¹Ù…Ø±Ø§Ù†', 'Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡', 'Ø¶Ø§Ù„Ø¹', 'Ù„Ø­Ø¬', 'Ø£Ø¨ÙŠÙ†'],
      'DZ': ['Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±', 'ÙˆÙ‡Ø±Ø§Ù†', 'Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©', 'Ø¹Ù†Ø§Ø¨Ø©', 'Ø¨Ø§ØªÙ†Ø©', 'Ø¨Ù„ÙŠØ¯Ø©', 'Ø³Ø·ÙŠÙ', 'Ø§Ù„Ø´Ù„Ù', 'ØªÙ„Ù…Ø³Ø§Ù†', 'Ø§Ù„Ø¬Ù„ÙØ©', 'Ø³Ø·ÙŠÙ', 'Ø³ÙƒÙŠÙƒØ¯Ø©', 'ØªÙŠØ§Ø±Øª', 'Ø£Ø¯Ø±Ø§Ø±'],
      'MA': ['Ø§Ù„Ø±Ø¨Ø§Ø·', 'Ø§Ù„Ø¯Ø§Ø± Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡', 'ÙØ§Ø³', 'Ù…Ø±Ø§ÙƒØ´', 'Ø·Ù†Ø¬Ø©', 'Ù…ÙƒÙ†Ø§Ø³', 'Ø£ÙƒØ§Ø¯ÙŠØ±', 'ÙˆØ¬Ø¯Ø©', 'ØªØ·ÙˆØ§Ù†', 'Ø§Ù„Ø¹ÙŠÙˆÙ†', 'Ø§Ù„Ù‚Ù†ÙŠØ·Ø±Ø©', 'Ø¨Ù†ÙŠ Ù…Ù„Ø§Ù„', 'Ø®Ø±ÙŠØ¨ÙƒØ©', 'ØªØ§Ø²Ø©'],
      'TN': ['ØªÙˆÙ†Ø³', 'ØµÙØ§Ù‚Ø³', 'Ø³ÙˆØ³Ø©', 'Ù‚Ø§Ø¨Ø³', 'Ø¨Ù†Ø²Ø±Øª', 'Ø§Ù„Ù‚ÙŠØ±ÙˆØ§Ù†', 'Ø¨Ø§Ø¬Ø©', 'Ù‚ÙØµØ©', 'Ø§Ù„Ù…Ù‡Ø¯ÙŠØ©', 'Ù…Ø¯Ù†ÙŠÙ†', 'Ù†Ø§Ø¨Ù„', 'Ø§Ù„Ø­ÙˆØ¶ÙŠÙ†', 'ØªØ·Ø§ÙˆÙŠÙ†', 'Ø§Ù„ÙƒØ§Ù'],
      'US': ['Ù†ÙŠÙˆÙŠÙˆØ±Ùƒ', 'Ù„ÙˆØ³ Ø£Ù†Ø¬Ù„ÙˆØ³', 'Ø´ÙŠÙƒØ§ØºÙˆ', 'Ù‡ÙŠÙˆØ³ØªÙ†', 'ÙÙŠÙ†ÙŠÙƒØ³', 'ÙÙŠÙ„Ø§Ø¯Ù„ÙÙŠØ§', 'Ø³Ø§Ù† Ø£Ù†Ø·ÙˆÙ†ÙŠÙˆ', 'Ø³Ø§Ù† Ø¯ÙŠÙŠØºÙˆ', 'Ø¯Ø§Ù„Ø§Ø³', 'Ø³Ø§Ù† Ø®ÙˆØ³ÙŠÙ‡'],
      'GB': ['Ù„Ù†Ø¯Ù†', 'Ø¨Ø±Ù…Ù†ØºÙ‡Ø§Ù…', 'Ù…Ø§Ù†Ø´Ø³ØªØ±', 'ØºÙ„Ø§Ø³ÙƒÙˆ', 'Ù„ÙŠÙØ±Ø¨ÙˆÙ„', 'Ù„ÙŠØ¯Ø²', 'Ø´ÙŠÙÙŠÙ„Ø¯', 'Ø¨Ø±ÙŠØ³ØªÙˆÙ„', 'ÙƒØ§Ø±Ø¯ÙŠÙ', 'Ø¥Ø¯Ù†Ø¨Ø±Ø©'],
      'CA': ['ØªÙˆØ±ÙˆÙ†ØªÙˆ', 'Ù…ÙˆÙ†ØªØ±ÙŠØ§Ù„', 'ÙØ§Ù†ÙƒÙˆÙØ±', 'ÙƒØ§Ù„ØºØ§Ø±ÙŠ', 'Ø¥Ø¯Ù…ÙˆÙ†ØªÙˆÙ†', 'Ø£ÙˆØªØ§ÙˆØ§', 'ÙˆÙŠÙ†ÙŠØ¨ÙŠØº', 'ÙƒÙŠØ¨ÙŠÙƒ'],
      'AU': ['Ø³ÙŠØ¯Ù†ÙŠ', 'Ù…Ù„Ø¨ÙˆØ±Ù†', 'Ø¨Ø±ÙŠØ²Ø¨Ø§Ù†', 'Ø¨ÙŠØ±Ø«', 'Ø£Ø¯ÙŠÙ„Ø§ÙŠØ¯', 'ÙƒØ§Ù†Ø¨Ø±Ø§', 'Ù‡ÙˆØ¨Ø§Ø±Øª', 'Ø¯Ø§Ø±ÙˆÙŠÙ†'],
      'FR': ['Ø¨Ø§Ø±ÙŠØ³', 'Ù…Ø±Ø³ÙŠÙ„ÙŠØ§', 'Ù„ÙŠÙˆÙ†', 'ØªÙˆÙ„ÙˆØ²', 'Ù†ÙŠØ³', 'Ù†Ø§Ù†Øª', 'Ø³ØªØ±Ø§Ø³Ø¨ÙˆØ±Øº', 'Ù…ÙˆÙ†Ø¨Ù„ÙŠÙŠÙ‡'],
      'DE': ['Ø¨Ø±Ù„ÙŠÙ†', 'Ù‡Ø§Ù…Ø¨ÙˆØ±Øº', 'Ù…ÙŠÙˆÙ†Ø®', 'ÙƒÙˆÙ„ÙˆÙ†ÙŠØ§', 'ÙØ±Ø§Ù†ÙƒÙÙˆØ±Øª', 'Ø´ØªÙˆØªØºØ§Ø±Øª', 'Ø¯ÙˆØ³Ù„Ø¯ÙˆØ±Ù', 'Ø¯ÙˆØ±ØªÙ…ÙˆÙ†Ø¯'],
      'IT': ['Ø±ÙˆÙ…Ø§', 'Ù…ÙŠÙ„Ø§Ù†Ùˆ', 'Ù†Ø§Ø¨ÙˆÙ„ÙŠ', 'ØªÙˆØ±ÙŠÙ†Ùˆ', 'Ø¨Ø§Ù„ÙŠØ±Ù…Ùˆ', 'Ø¬Ù†ÙˆØ©', 'Ø¨ÙˆÙ„ÙˆÙ†ÙŠØ§', 'ÙÙ„ÙˆØ±Ù†Ø³Ø§']
    };
    
    // Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
    const currencies = [
      {id: 'SAR', name: 'Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ', symbol: 'ï·¼'},
      {id: 'AED', name: 'Ø¯Ø±Ù‡Ù… Ø¥Ù…Ø§Ø±Ø§ØªÙŠ', symbol: 'Ø¯.Ø¥'},
      {id: 'QAR', name: 'Ø±ÙŠØ§Ù„ Ù‚Ø·Ø±ÙŠ', symbol: 'Ø±.Ù‚'},
      {id: 'KWD', name: 'Ø¯ÙŠÙ†Ø§Ø± ÙƒÙˆÙŠØªÙŠ', symbol: 'Ø¯.Ùƒ'},
      {id: 'BHD', name: 'Ø¯ÙŠÙ†Ø§Ø± Ø¨Ø­Ø±ÙŠÙ†ÙŠ', symbol: '.Ø¯.Ø¨'},
      {id: 'OMR', name: 'Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ', symbol: 'Ø±.Ø¹.'},
      {id: 'JOD', name: 'Ø¯ÙŠÙ†Ø§Ø± Ø£Ø±Ø¯Ù†ÙŠ', symbol: 'Ø¯.Ø§'},
      {id: 'EGP', name: 'Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ', symbol: 'Ø¬.Ù…'},
      {id: 'LBP', name: 'Ù„ÙŠØ±Ø© Ù„Ø¨Ù†Ø§Ù†ÙŠØ©', symbol: 'Ù„.Ù„'},
      {id: 'SYP', name: 'Ù„ÙŠØ±Ø© Ø³ÙˆØ±ÙŠØ©', symbol: 'Ù„.Ø³'},
      {id: 'YER', name: 'Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ', symbol: 'Ø±.ÙŠ'},
      {id: 'IQD', name: 'Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø±Ø§Ù‚ÙŠ', symbol: 'Ø¯.Ø¹'},
      {id: 'DZD', name: 'Ø¯ÙŠÙ†Ø§Ø± Ø¬Ø²Ø§Ø¦Ø±ÙŠ', symbol: 'Ø¯.Ø¬'},
      {id: 'MAD', name: 'Ø¯Ø±Ù‡Ù… Ù…ØºØ±Ø¨ÙŠ', symbol: 'Ø¯.Ù….'},
      {id: 'TND', name: 'Ø¯ÙŠÙ†Ø§Ø± ØªÙˆÙ†Ø³ÙŠ', symbol: 'Ø¯.Øª'},
      {id: 'LYD', name: 'Ø¯ÙŠÙ†Ø§Ø± Ù„ÙŠØ¨ÙŠ', symbol: 'Ø¯.Ù„'},
      {id: 'SDG', name: 'Ø¬Ù†ÙŠÙ‡ Ø³ÙˆØ¯Ø§Ù†ÙŠ', symbol: 'Ø¬.Ø³.'},
      {id: 'USD', name: 'Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ', symbol: '$'},
      {id: 'EUR', name: 'ÙŠÙˆØ±Ùˆ', symbol: 'â‚¬'},
      {id: 'GBP', name: 'Ø¬Ù†ÙŠÙ‡ Ø¥Ø³ØªØ±Ù„ÙŠÙ†ÙŠ', symbol: 'Â£'},
      {id: 'CAD', name: 'Ø¯ÙˆÙ„Ø§Ø± ÙƒÙ†Ø¯ÙŠ', symbol: 'CA$'},
      {id: 'AUD', name: 'Ø¯ÙˆÙ„Ø§Ø± Ø£Ø³ØªØ±Ø§Ù„ÙŠ', symbol: 'A$'},
      {id: 'NZD', name: 'Ø¯ÙˆÙ„Ø§Ø± Ù†ÙŠÙˆØ²ÙŠÙ„Ù†Ø¯ÙŠ', symbol: 'NZ$'},
      {id: 'CHF', name: 'ÙØ±Ù†Ùƒ Ø³ÙˆÙŠØ³Ø±ÙŠ', symbol: 'Fr'},
      {id: 'JPY', name: 'ÙŠÙ† ÙŠØ§Ø¨Ø§Ù†ÙŠ', symbol: 'Â¥'},
      {id: 'CNY', name: 'ÙŠÙˆØ§Ù† ØµÙŠÙ†ÙŠ', symbol: 'Â¥'},
      {id: 'KRW', name: 'ÙˆÙˆÙ† ÙƒÙˆØ±ÙŠ Ø¬Ù†ÙˆØ¨ÙŠ', symbol: 'â‚©'},
      {id: 'INR', name: 'Ø±ÙˆØ¨ÙŠØ© Ù‡Ù†Ø¯ÙŠØ©', symbol: 'â‚¹'},
      {id: 'RUB', name: 'Ø±ÙˆØ¨Ù„ Ø±ÙˆØ³ÙŠ', symbol: 'â‚½'},
      {id: 'TRY', name: 'Ù„ÙŠØ±Ø© ØªØ±ÙƒÙŠØ©', symbol: 'â‚º'},
      {id: 'BRL', name: 'Ø±ÙŠØ§Ù„ Ø¨Ø±Ø§Ø²ÙŠÙ„ÙŠ', symbol: 'R$'},
      {id: 'MXN', name: 'Ø¨ÙŠØ²Ùˆ Ù…ÙƒØ³ÙŠÙƒÙŠ', symbol: '$'},
      {id: 'ZAR', name: 'Ø±Ø§Ù†Ø¯ Ø¬Ù†ÙˆØ¨ Ø£ÙØ±ÙŠÙ‚ÙŠ', symbol: 'R'},
      {id: 'SEK', name: 'ÙƒØ±ÙˆÙ†Ø© Ø³ÙˆÙŠØ¯ÙŠØ©', symbol: 'kr'},
      {id: 'NOK', name: 'ÙƒØ±ÙˆÙ†Ø© Ù†Ø±ÙˆÙŠØ¬ÙŠØ©', symbol: 'kr'},
      {id: 'DKK', name: 'ÙƒØ±ÙˆÙ†Ø© Ø¯Ù†Ù…Ø§Ø±ÙƒÙŠØ©', symbol: 'kr'},
      {id: 'PLN', name: 'Ø²Ù„ÙˆØªÙŠ Ø¨ÙˆÙ„Ù†Ø¯ÙŠ', symbol: 'zÅ‚'},
      {id: 'HUF', name: 'ÙÙˆØ±Ù†Øª Ù…Ø¬Ø±ÙŠ', symbol: 'Ft'},
      {id: 'CZK', name: 'ÙƒØ±ÙˆÙ†Ø© ØªØ´ÙŠÙƒÙŠØ©', symbol: 'KÄ'},
      {id: 'ILS', name: 'Ø´ÙŠÙƒÙ„ Ø¥Ø³Ø±Ø§Ø¦ÙŠÙ„ÙŠ', symbol: 'â‚ª'},
      {id: 'PKR', name: 'Ø±ÙˆØ¨ÙŠØ© Ø¨Ø§ÙƒØ³ØªØ§Ù†ÙŠØ©', symbol: 'â‚¨'},
      {id: 'BDT', name: 'ØªØ§ÙƒØ§ Ø¨Ù†ØºÙ„Ø§Ø¯ÙŠØ´ÙŠ', symbol: 'à§³'},
      {id: 'THB', name: 'Ø¨Ø§Ø®Øª ØªØ§ÙŠÙ„Ø§Ù†Ø¯ÙŠ', symbol: 'à¸¿'},
      {id: 'IDR', name: 'Ø±ÙˆØ¨ÙŠØ© Ø¥Ù†Ø¯ÙˆÙ†ÙŠØ³ÙŠØ©', symbol: 'Rp'},
      {id: 'MYR', name: 'Ø±ÙŠÙ†ØºÙŠØª Ù…Ø§Ù„ÙŠØ²ÙŠ', symbol: 'RM'},
      {id: 'PHP', name: 'Ø¨ÙŠØ²Ùˆ ÙÙ„Ø¨ÙŠÙ†ÙŠ', symbol: 'â‚±'},
      {id: 'SGD', name: 'Ø¯ÙˆÙ„Ø§Ø± Ø³Ù†ØºØ§ÙÙˆØ±ÙŠ', symbol: 'S$'},
      {id: 'HKD', name: 'Ø¯ÙˆÙ„Ø§Ø± Ù‡ÙˆÙ†Øº ÙƒÙˆÙ†Øº', symbol: 'HK$'},
      {id: 'TWD', name: 'Ø¯ÙˆÙ„Ø§Ø± ØªØ§ÙŠÙˆØ§Ù†ÙŠ', symbol: 'NT$'}
    ];
    
    // Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ù„Ù„Ø¯ÙˆÙ„
    const countryCurrencyMap = {
      'SA': 'SAR', 'AE': 'AED', 'QA': 'QAR', 'KW': 'KWD', 'BH': 'BHD',
      'OM': 'OMR', 'JO': 'JOD', 'LB': 'LBP', 'EG': 'EGP', 'MA': 'MAD',
      'TN': 'TND', 'DZ': 'DZD', 'IQ': 'IQD', 'SY': 'SYP', 'YE': 'YER',
      'SD': 'SDG', 'LY': 'LYD', 'US': 'USD', 'GB': 'GBP', 'CA': 'CAD',
      'AU': 'AUD', 'FR': 'EUR', 'DE': 'EUR', 'IT': 'EUR', 'ES': 'EUR',
      'TR': 'TRY', 'IN': 'INR', 'CN': 'CNY', 'JP': 'JPY', 'KR': 'KRW',
      'RU': 'RUB', 'BR': 'BRL'
    };
    
    let currentUser = null;
    
    function showMessage(type, text) {
      const messageDiv = document.getElementById('message');
      messageDiv.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i> 
        ${text}
      `;
      messageDiv.className = `message ${type}`;
      messageDiv.style.display = 'block';
      
      if (type !== 'success') {
        setTimeout(() => {
          messageDiv.style.display = 'none';
        }, 5000);
      }
    }

    function validateInputs() {
      const fullName = document.getElementById('fullName').value.trim();
      const birthDay = document.getElementById('birthDay').value;
      const birthMonth = document.getElementById('birthMonth').value;
      const birthYear = document.getElementById('birthYear').value;
      const phoneCode = document.getElementById('phoneCode').value;
      const phone = document.getElementById('phone').value.trim();
      const storeName = document.getElementById('storeName').value.trim();
      const storeType = document.getElementById('storeType').value;
      const country = document.getElementById('country').value;
      const city = document.getElementById('city').value;
      const currency = document.getElementById('currency').value;
      
      if (!fullName) {
        showMessage('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„');
        return false;
      }
      
      if (!birthDay || !birthMonth || !birthYear) {
        showMessage('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ ÙƒØ§Ù…Ù„Ø§Ù‹');
        return false;
      }
      
      if (!phoneCode || !phone) {
        showMessage('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙƒØ§Ù…Ù„Ø§Ù‹');
        return false;
      }
      
      const phoneRegex = /^[0-9]{8,15}$/;
      if (!phoneRegex.test(phone)) {
        showMessage('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ­ÙŠØ­ (8-15 Ø±Ù‚Ù…)');
        return false;
      }
      
      if (!storeName) {
        showMessage('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±');
        return false;
      }
      
      if (!storeType) {
        showMessage('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­Ù„');
        return false;
      }
      
      if (!country) {
        showMessage('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯ÙˆÙ„Ø©');
        return false;
      }
      
      if (!city) {
        showMessage('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©');
        return false;
      }
      
      if (!currency) {
        showMessage('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…Ù„Ø©');
        return false;
      }
      
      return true;
    }

    function parseBirthDate(birthDate) {
      if (!birthDate) return { day: '', month: '', year: '' };
      
      try {
        const dateParts = birthDate.split('-');
        if (dateParts.length === 3) {
          return {
            year: dateParts[0],
            month: dateParts[1].replace(/^0+/, ''),
            day: dateParts[2].replace(/^0+/, '')
          };
        }
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:', error);
      }
      
      return { day: '', month: '', year: '' };
    }

    async function loadUserProfile(user) {
      try {
        const userDoc = await getDoc(doc(db, "dnrx_users", user.uid));
        
        if (userDoc.exists()) {
          const userData = userDoc.data();
          currentUser = { uid: user.uid, ...userData };
          
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
          document.getElementById('userName').textContent = userData.fullName || 'Ù…Ø³ØªØ®Ø¯Ù…';
          document.getElementById('userEmail').textContent = userData.email || user.email;
          document.getElementById('displayEmail').textContent = userData.email || user.email;
          document.getElementById('userId').textContent = user.uid.substring(0, 8) + '...';
          
          // ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
          const avatarElement = document.getElementById('userAvatar');
          if (userData.photoURL) {
            avatarElement.innerHTML = `<img src="${userData.photoURL}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">`;
          } else {
            const initials = userData.fullName ? userData.fullName.charAt(0) : 'Ù…';
            avatarElement.innerHTML = `<span>${initials}</span>`;
          }
          
          // ØªØ­Ø¯ÙŠØ« ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„
          if (userData.createdAt) {
            const date = userData.createdAt.toDate ? userData.createdAt.toDate() : new Date(userData.createdAt);
            document.getElementById('createdAt').textContent = date.toLocaleDateString('ar-SA');
          } else {
            document.getElementById('createdAt').textContent = 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
          }
          
          // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨
          const statusElement = document.getElementById('profileStatus');
          if (userData.approved === false) {
            statusElement.style.display = 'flex';
          } else {
            statusElement.style.display = 'none';
          }
          
          // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„
          document.getElementById('fullName').value = userData.fullName || '';
          
          const birthDate = parseBirthDate(userData.birthDate);
          document.getElementById('birthDay').value = birthDate.day;
          document.getElementById('birthMonth').value = birthDate.month;
          document.getElementById('birthYear').value = birthDate.year;
          
          document.getElementById('phoneCode').value = userData.phoneCode || '+966';
          document.getElementById('phone').value = userData.phone || '';
          
          document.getElementById('storeName').value = userData.storeName || '';
          document.getElementById('storeType').value = userData.storeType || '';
          
          if (userData.country) {
            $('#country').val(userData.country).trigger('change');
          }
          
          if (userData.city) {
            setTimeout(() => {
              $('#city').val(userData.city).trigger('change');
            }, 500);
          }
          
          if (userData.currency) {
            setTimeout(() => {
              $('#currency').val(userData.currency).trigger('change');
            }, 1000);
          }
          
          return true;
        } else {
          showMessage('error', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
          return false;
        }
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ:', error);
        showMessage('error', 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ');
        return false;
      }
    }

    async function saveProfile() {
      if (!validateInputs()) {
        return;
      }
      
      if (!currentUser) {
        showMessage('error', 'Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
        return;
      }
      
      const fullName = document.getElementById('fullName').value.trim();
      const birthDay = document.getElementById('birthDay').value;
      const birthMonth = document.getElementById('birthMonth').value;
      const birthYear = document.getElementById('birthYear').value;
      const phoneCode = document.getElementById('phoneCode').value;
      const phone = document.getElementById('phone').value.trim();
      const storeName = document.getElementById('storeName').value.trim();
      const storeType = document.getElementById('storeType').value;
      const country = document.getElementById('country').value;
      const city = document.getElementById('city').value;
      const currency = document.getElementById('currency').value;
      
      const saveBtn = document.getElementById('saveBtn');
      const originalText = saveBtn.innerHTML;
      saveBtn.innerHTML = '<span class="spinner"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
      saveBtn.disabled = true;
      
      try {
        const birthDate = `${birthYear}-${birthMonth.padStart(2, '0')}-${birthDay.padStart(2, '0')}`;
        
        const updates = {
          fullName: fullName,
          birthDate: birthDate,
          phoneCode: phoneCode,
          phone: phone,
          fullPhone: phoneCode + phone,
          storeName: storeName,
          storeType: storeType,
          country: country,
          city: city,
          currency: currency,
          profileComplete: true,
          updatedAt: serverTimestamp()
        };
        
        await updateDoc(doc(db, "dnrx_users", currentUser.uid), updates);
        
        // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª localStorage
        const savedUser = JSON.parse(localStorage.getItem('dnrx_user') || '{}');
        localStorage.setItem('dnrx_user', JSON.stringify({
          ...savedUser,
          ...updates,
          uid: currentUser.uid,
          email: currentUser.email
        }));
        
        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        document.getElementById('userName').textContent = fullName;
        
        showMessage('success', 'ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
        
        setTimeout(() => {
          if (currentUser.userType === 'admin') {
            window.location.href = 'admin.html';
          } else {
            window.location.href = 'main.html';
          }
        }, 1500);
        
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ:', error);
        showMessage('error', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª');
        
        saveBtn.innerHTML = originalText;
        saveBtn.disabled = false;
      }
    }
    
    $(document).ready(function() {
      // ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯ÙˆÙ„
      $('.country-select').select2({
        data: countries.map(country => ({
          id: country.id,
          text: country.name
        })),
        placeholder: "Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¯ÙˆÙ„Ø©...",
        allowClear: false,
        language: {
          noResults: function() {
            return "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬";
          },
          searching: function() {
            return "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...";
          }
        }
      }).on('change', function() {
        const countryCode = $(this).val();
        const country = countries.find(c => c.id === countryCode);
        
        if (country) {
          // ØªØ­Ø¯ÙŠØ« Ø±Ù…Ø² Ø§Ù„Ù‡Ø§ØªÙ
          $('#phoneCode').val(country.phoneCode);
          
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
          const defaultCurrency = countryCurrencyMap[countryCode] || 'USD';
          $('.currency-select').val(defaultCurrency).trigger('change');
          
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¯Ù†
          const citySelect = $('#city');
          citySelect.empty();
          citySelect.append('<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©...</option>');
          
          if (citiesByCountry[countryCode]) {
            citiesByCountry[countryCode].forEach(city => {
              citySelect.append(`<option value="${city}">${city}</option>`);
            });
          } else {
            citySelect.append('<option value="">Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>');
          }
          
          citySelect.select2({
            placeholder: "Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©...",
            allowClear: false
          });
        }
      });
      
      // ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Øª
      $('.currency-select').select2({
        data: currencies.map(currency => ({
          id: currency.id,
          text: `${currency.name} (${currency.symbol})`
        })),
        placeholder: "Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…Ù„Ø©...",
        allowClear: false
      });
      
      // ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯Ù†
      $('#city').select2({
        placeholder: "Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©...",
        allowClear: false
      });
      
      // ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø±Ù…ÙˆØ² Ø§Ù„Ù‡Ø§ØªÙ
      const phoneCodeSelect = $('#phoneCode');
      phoneCodeSelect.empty();
      
      const uniquePhoneCodes = [];
      const phoneCodesMap = {};
      
      countries.forEach(country => {
        if (!phoneCodesMap[country.phoneCode]) {
          phoneCodesMap[country.phoneCode] = true;
          uniquePhoneCodes.push({
            code: country.phoneCode,
            name: `${country.phoneCode} (${country.name})`
          });
        }
      });
      
      uniquePhoneCodes.sort((a, b) => {
        if (a.code === '+966') return -1;
        if (b.code === '+966') return 1;
        return a.name.localeCompare(b.name);
      });
      
      uniquePhoneCodes.forEach(phoneCode => {
        phoneCodeSelect.append(`<option value="${phoneCode.code}">${phoneCode.name}</option>`);
      });
      
      // ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
      $('#phone').on('input', function() {
        let value = $(this).val().replace(/\D/g, '');
        $(this).val(value.substring(0, 15));
      });
      
      // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø± Ù„Ø²Ø± Ø§Ù„Ø­ÙØ¸
      document.getElementById('saveBtn').addEventListener('click', saveProfile);
    });
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        await loadUserProfile(user);
      } else {
        window.location.href = 'login.html';
      }
    });
    
    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¶ØºØ· Enter Ù„Ù„Ø­ÙØ¸
    document.addEventListener('keypress', function(event) {
      if (event.key === 'Enter') {
        saveProfile();
      }
    });
    
    window.addEventListener('load', () => {
      console.log('ğŸš€ ØµÙØ­Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ø¬Ø§Ù‡Ø²Ø©');
    });
  </script>
</body>
</html>