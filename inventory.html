<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø°ÙƒÙŠ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 12px;
      background: #f5f5f5;
      color: #333;
      line-height: 1.6;
      font-size: 14px;
    }
    
    .container {
      max-width: 100%;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #2c3e50;
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    h1 {
      font-size: 20px;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      color: #2c3e50;
    }
    
    .subtitle {
      color: #7f8c8d;
      font-size: 12px;
    }
    
    .tabs {
      display: flex;
      background: #ecf0f1;
      border-radius: 8px;
      padding: 4px;
      margin-bottom: 15px;
      border: 1px solid #bdc3c7;
      overflow-x: auto;
    }
    
    .tab-btn {
      flex: 1;
      padding: 10px 8px;
      border: none;
      background: transparent;
      color: #7f8c8d;
      cursor: pointer;
      font-size: 12px;
      border-radius: 6px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      min-width: 80px;
      white-space: nowrap;
    }
    
    .tab-btn.active {
      background: #3498db;
      color: white;
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(52, 152, 219, 0.3);
    }
    
    .tab-content {
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .tab-content.active {
      display: block;
    }
    
    .search-section {
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .search-box {
      position: relative;
      margin-bottom: 10px;
    }
    
    .search-input input {
      width: 100%;
      padding: 12px 40px 12px 12px;
      border: 1px solid #ddd;
      font-size: 14px;
      border-radius: 8px;
      transition: border-color 0.3s;
    }
    
    .search-input input:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }
    
    .search-input i {
      position: absolute;
      top: 50%;
      left: 12px;
      transform: translateY(-50%);
      color: #95a5a6;
      font-size: 14px;
    }
    
    .scan-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    
    .btn-scan {
      padding: 12px;
      border: 1px solid #3498db;
      border-radius: 8px;
      background: white;
      color: #3498db;
      font-size: 13px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.3s ease;
      font-weight: 500;
    }
    
    .btn-scan:hover {
      background: #f8f9fa;
      transform: translateY(-1px);
    }
    
    .btn-scan-primary {
      background: #3498db;
      color: white;
    }
    
    .btn-scan-primary:hover {
      background: #2980b9;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .stat-card {
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 12px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      transition: transform 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-2px);
    }
    
    .stat-value {
      font-size: 22px;
      font-weight: bold;
      margin-bottom: 5px;
      color: #2c3e50;
    }
    
    .stat-label {
      color: #7f8c8d;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .product-card {
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 12px;
      transition: all 0.3s ease;
      position: relative;
      font-size: 13px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .product-card:hover {
      border-color: #3498db;
      box-shadow: 0 4px 8px rgba(52, 152, 219, 0.15);
      transform: translateY(-2px);
    }
    
    .product-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
    }
    
    .product-name {
      font-weight: 600;
      font-size: 13px;
      flex: 1;
      margin-right: 8px;
      color: #2c3e50;
      line-height: 1.4;
    }
    
    .product-stock {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 12px;
      background: #f0f0f0;
      white-space: nowrap;
      font-weight: 600;
    }
    
    .stock-green {
      background: #d4f7e2;
      color: #27ae60;
    }
    
    .stock-yellow {
      background: #fff8e1;
      color: #f39c12;
    }
    
    .stock-red {
      background: #ffeaea;
      color: #e74c3c;
    }
    
    .stock-gray {
      background: #f5f5f5;
      color: #95a5a6;
    }
    
    .product-price {
      font-size: 15px;
      font-weight: bold;
      margin-bottom: 8px;
      color: #2c3e50;
    }
    
    .product-barcode {
      font-size: 11px;
      color: #7f8c8d;
      background: #f8f9fa;
      padding: 4px 8px;
      border-radius: 4px;
      margin-bottom: 10px;
      font-family: 'Courier New', monospace;
      text-align: center;
      direction: ltr;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .product-actions {
      display: flex;
      gap: 8px;
    }
    
    .btn-action {
      flex: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 6px;
      background: white;
      color: #333;
      cursor: pointer;
      font-size: 11px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      transition: all 0.2s ease;
      font-weight: 500;
    }
    
    .btn-action:hover {
      background: #f8f9fa;
    }
    
    .btn-action-success {
      background: #27ae60;
      color: white;
      border-color: #27ae60;
    }
    
    .btn-action-success:hover {
      background: #219653;
    }
    
    .btn-action-primary {
      background: #3498db;
      color: white;
      border-color: #3498db;
    }
    
    .btn-action-primary:hover {
      background: #2980b9;
    }
    
    .btn-action-warning {
      background: #f39c12;
      color: white;
      border-color: #f39c12;
    }
    
    .btn-action-warning:hover {
      background: #d68910;
    }
    
    .product-source {
      position: absolute;
      top: 8px;
      left: 8px;
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 10px;
      font-weight: 600;
    }
    
    .source-personal {
      background: #d4f7e2;
      color: #27ae60;
    }
    
    .source-general {
      background: #e3f2fd;
      color: #2980b9;
    }
    
    .source-pending {
      background: #fff8e1;
      color: #f39c12;
    }
    
    .store-name {
      font-size: 11px;
      color: #7f8c8d;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .form-section {
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .form-title {
      font-size: 16px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      color: #2c3e50;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
    
    .form-group {
      margin-bottom: 12px;
    }
    
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      font-size: 13px;
      color: #2c3e50;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      font-size: 14px;
      border-radius: 6px;
      transition: all 0.3s;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }
    
    .product-type-selector {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      background: #f8f9fa;
    }
    
    .type-option {
      flex: 1;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 6px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 12px;
      font-weight: 500;
    }
    
    .type-option.active {
      border-color: #3498db;
      background: #3498db;
      color: white;
      box-shadow: 0 2px 4px rgba(52, 152, 219, 0.3);
    }
    
    .type-option i {
      display: block;
      margin-bottom: 5px;
      font-size: 16px;
    }
    
    .category-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 8px;
      margin-top: 5px;
    }
    
    .category-btn {
      padding: 10px;
      border: 1px solid #ddd;
      background: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      text-align: center;
      transition: all 0.2s ease;
    }
    
    .category-btn.active {
      background: #3498db;
      color: white;
      border-color: #3498db;
    }
    
    .telegram-settings {
      margin-top: 15px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 8px;
      border: 1px solid #e9ecef;
    }
    
    .telegram-setting-item {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .telegram-setting-label {
      font-size: 12px;
      color: #7f8c8d;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .telegram-setting-input {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .telegram-setting-input input {
      flex: 1;
      padding: 8px;
      font-size: 13px;
    }
    
    .telegram-status {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 12px;
      margin-top: 5px;
      text-align: center;
      font-weight: 600;
    }
    
    .status-active {
      background: #d4f7e2;
      color: #27ae60;
      border: 1px solid #c3e6cb;
    }
    
    .status-inactive {
      background: #f8f9fa;
      color: #95a5a6;
      border: 1px solid #e9ecef;
    }
    
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 15px;
      animation: fadeIn 0.3s ease;
    }
    
    .modal-content {
      background: white;
      border-radius: 10px;
      padding: 15px;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      font-size: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #3498db;
    }
    
    .modal-title {
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      color: #2c3e50;
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #7f8c8d;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.3s;
    }
    
    .modal-close:hover {
      background: #f5f5f5;
    }
    
    .scanner-container {
      position: relative;
      width: 100%;
      height: 250px;
      background: #000;
      margin-bottom: 15px;
      overflow: hidden;
      border-radius: 8px;
    }
    
    #scanner-video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scaleX(-1);
    }
    
    .scanner-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80%;
      height: 150px;
      border: 3px solid rgba(52, 152, 219, 0.8);
      box-shadow: 0 0 0 1000px rgba(0, 0, 0, 0.7);
      pointer-events: none;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { border-color: rgba(52, 152, 219, 0.8); }
      50% { border-color: rgba(52, 152, 219, 0.4); }
      100% { border-color: rgba(52, 152, 219, 0.8); }
    }
    
    .scanner-stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
      font-size: 12px;
      color: #7f8c8d;
    }
    
    .scan-result {
      padding: 12px;
      border: 1px solid #ddd;
      background: #f8f9fa;
      text-align: center;
      font-size: 13px;
      margin-bottom: 12px;
      border-radius: 8px;
      min-height: 50px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      transition: all 0.3s;
    }
    
    .result-success {
      background: #d4f7e2;
      border-color: #c3e6cb;
      color: #27ae60;
    }
    
    .result-error {
      background: #ffeaea;
      border-color: #f5c6cb;
      color: #e74c3c;
    }
    
    .result-info {
      background: #e3f2fd;
      border-color: #bee5eb;
      color: #2980b9;
    }
    
    .manual-input {
      margin-top: 15px;
    }
    
    .manual-input input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      margin-bottom: 10px;
      border-radius: 8px;
      font-size: 16px;
      text-align: center;
      font-family: monospace;
    }
    
    .modal-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }
    
    .btn-modal {
      padding: 12px;
      border: 1px solid #3498db;
      border-radius: 8px;
      background: white;
      color: #3498db;
      cursor: pointer;
      font-size: 13px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.3s;
      font-weight: 500;
    }
    
    .btn-modal:hover {
      background: #f8f9fa;
      transform: translateY(-1px);
    }
    
    .btn-modal-primary {
      background: #3498db;
      color: white;
    }
    
    .btn-modal-primary:hover {
      background: #2980b9;
    }
    
    .barcode-field {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .barcode-field input {
      flex: 1;
    }
    
    .btn-barcode {
      padding: 10px 12px;
      border: 1px solid #3498db;
      border-radius: 8px;
      background: #3498db;
      color: white;
      cursor: pointer;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: all 0.3s;
    }
    
    .btn-barcode:hover {
      background: #2980b9;
      transform: translateY(-1px);
    }
    
    .button-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }
    
    .btn {
      padding: 12px 15px;
      border: 1px solid #3498db;
      border-radius: 8px;
      font-size: 13px;
      cursor: pointer;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: white;
      color: #3498db;
      transition: all 0.3s ease;
      font-weight: 500;
    }
    
    .btn:hover {
      background: #f8f9fa;
      transform: translateY(-1px);
    }
    
    .btn-primary {
      background: #3498db;
      color: white;
    }
    
    .btn-primary:hover {
      background: #2980b9;
    }
    
    .btn-success {
      background: #27ae60;
      color: white;
      border-color: #27ae60;
    }
    
    .btn-success:hover {
      background: #219653;
    }
    
    .btn-warning {
      background: #f39c12;
      color: white;
      border-color: #f39c12;
    }
    
    .btn-warning:hover {
      background: #d68910;
    }
    
    .btn-danger {
      background: #e74c3c;
      color: white;
      border-color: #e74c3c;
    }
    
    .btn-danger:hover {
      background: #c0392b;
    }
    
    .btn-full {
      width: 100%;
      margin-top: 10px;
    }
    
    .empty-state {
      text-align: center;
      padding: 30px 15px;
      color: #95a5a6;
      border: 2px dashed #ddd;
      border-radius: 8px;
      margin: 15px 0;
      font-size: 13px;
    }
    
    .empty-state i {
      font-size: 32px;
      margin-bottom: 10px;
      color: #bdc3c7;
    }
    
    .loading {
      text-align: center;
      padding: 40px 15px;
      color: #95a5a6;
      font-size: 13px;
    }
    
    .loading i {
      font-size: 24px;
      margin-bottom: 10px;
      color: #3498db;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    footer {
      text-align: center;
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid #ddd;
      color: #7f8c8d;
      font-size: 12px;
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    
    .telegram-test {
      background: #0088cc;
      color: white;
      border-color: #0088cc;
      font-size: 13px;
    }
    
    .telegram-test:hover {
      background: #006699;
    }
    
    .admin-badge {
      background: #9b59b6;
      color: white;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 10px;
      margin-left: 5px;
    }
    
    .auth-buttons {
      margin-top: 15px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .btn-auth {
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 13px;
      cursor: pointer;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: #f8f9fa;
      color: #333;
      transition: all 0.3s;
    }
    
    .btn-auth:hover {
      background: #e9ecef;
      transform: translateY(-1px);
    }
    
    .btn-auth-logout {
      background: #e74c3c;
      color: white;
      border-color: #e74c3c;
    }
    
    .btn-auth-logout:hover {
      background: #c0392b;
    }
    
    .settings-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
      margin-top: 20px;
    }
    
    .settings-card {
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .settings-title {
      font-size: 16px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
      color: #2c3e50;
    }
    
    .bot-status {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .bot-connected {
      background: #d4f7e2;
      color: #27ae60;
      border: 1px solid #c3e6cb;
    }
    
    .bot-disconnected {
      background: #ffeaea;
      color: #e74c3c;
      border: 1px solid #f5c6cb;
    }
    
    .manual-barcode-section {
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin-top: 12px;
    }
    
    .barcode-input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
    }
    
    .barcode-input-group input {
      flex: 1;
      padding: 12px;
      font-size: 16px;
    }
    
    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 12px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      z-index: 1001;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      animation: slideIn 0.3s ease;
      max-width: 300px;
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .notification-success {
      background: #27ae60;
    }
    
    .notification-error {
      background: #e74c3c;
    }
    
    .notification-info {
      background: #3498db;
    }
    
    .notification-warning {
      background: #f39c12;
    }
    
    .user-role {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 10px;
      margin-right: 5px;
    }
    
    .role-admin {
      background: #9b59b6;
      color: white;
    }
    
    .role-user {
      background: #3498db;
      color: white;
    }
    
    .section-title {
      font-size: 16px;
      margin: 20px 0 15px 0;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
      color: #2c3e50;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    @media (max-width: 480px) {
      body {
        padding: 10px;
        font-size: 13px;
      }
      
      .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
        gap: 10px;
      }
      
      .modal-content {
        padding: 12px;
      }
      
      .scanner-container {
        height: 200px;
      }
      
      .btn, .btn-modal, .btn-scan {
        padding: 10px;
        font-size: 12px;
      }
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-boxes"></i> Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø°ÙƒÙŠ</h1>
      <p class="subtitle" id="userGreeting">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
      <div id="userRoleBadge" style="margin-top: 5px; font-size: 11px;"></div>
    </header>
    
    <div class="tabs">
      <button class="tab-btn active" data-tab="my-products">
        <i class="fas fa-store"></i> Ù…Ù†ØªØ¬Ø§ØªÙŠ
      </button>
      <button class="tab-btn" data-tab="general-store">
        <i class="fas fa-warehouse"></i> Ø§Ù„Ø¹Ø§Ù…
      </button>
      <button class="tab-btn" data-tab="add-product">
        <i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ©
      </button>
      <button class="tab-btn" data-tab="settings">
        <i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
      </button>
      <button class="tab-btn" data-tab="pending-products" id="pendingTab" style="display: none;">
        <i class="fas fa-clock"></i> ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±
        <span class="pending-count" style="font-size: 10px; background: #f39c12; color: white; border-radius: 50%; width: 16px; height: 16px; display: inline-flex; align-items: center; justify-content: center; margin-right: 5px;"></span>
      </button>
    </div>
    
    <!-- ØªØ¨ÙˆÙŠØ¨ Ù…Ù†ØªØ¬Ø§ØªÙŠ -->
    <div id="my-products" class="tab-content active">
      <div class="search-section">
        <div class="search-box">
          <div class="search-input">
            <input type="text" id="searchMyProducts" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ù…Ù†ØªØ¬Ø§ØªÙƒ Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯...">
            <i class="fas fa-search"></i>
          </div>
        </div>
        
        <div class="scan-buttons">
          <button class="btn-scan btn-scan-primary" onclick="openScanner('search-my')">
            <i class="fas fa-camera"></i> Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
          </button>
          <button class="btn-scan" onclick="openManualBarcode('search-my')">
            <i class="fas fa-keyboard"></i> Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ
          </button>
        </div>
      </div>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="myTotalProducts">0</div>
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-value" id="myLowStockCount">0</div>
          <div class="stat-label">ÙƒÙ…ÙŠØ© Ù…Ù†Ø®ÙØ¶Ø©</div>
        </div>
      </div>
      
      <h3 class="section-title">
        <i class="fas fa-list"></i> Ù…Ù†ØªØ¬Ø§ØªÙŠ (<span id="myProductsCount">0</span>)
      </h3>
      
      <div class="products-grid" id="myProductsList">
        <div class="loading">
          <i class="fas fa-spinner"></i>
          <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</p>
        </div>
      </div>
      
      <button class="btn btn-primary btn-full" onclick="exportMyProducts()">
        <i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
      </button>
    </div>
    
    <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø¹Ø§Ù… -->
    <div id="general-store" class="tab-content">
      <div class="search-section">
        <div class="search-box">
          <div class="search-input">
            <input type="text" id="searchGeneralProducts" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø¹Ø§Ù…...">
            <i class="fas fa-search"></i>
          </div>
        </div>
        
        <div class="scan-buttons">
          <button class="btn-scan btn-scan-primary" onclick="openScanner('search-general')">
            <i class="fas fa-camera"></i> Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
          </button>
          <button class="btn-scan" onclick="openManualBarcode('search-general')">
            <i class="fas fa-keyboard"></i> Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ
          </button>
        </div>
      </div>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="generalTotalProducts">0</div>
          <div class="stat-label">Ù…Ù†ØªØ¬ Ø¹Ø§Ù…</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-value" id="generalPopularCount">0</div>
          <div class="stat-label">Ø§Ù„Ø£ÙƒØ«Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Ù‹</div>
        </div>
      </div>
      
      <h3 class="section-title">
        <i class="fas fa-globe"></i> Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø¹Ø§Ù… (<span id="generalProductsCount">0</span>)
      </h3>
      
      <div class="products-grid" id="generalProductsList">
        <div class="loading">
          <i class="fas fa-spinner"></i>
          <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©...</p>
        </div>
      </div>
      
      <button class="btn btn-success btn-full" onclick="syncWithGeneralStore()">
        <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø¹Ø§Ù…
      </button>
    </div>
    
    <!-- ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ -->
    <div id="add-product" class="tab-content">
      <div class="form-section">
        <h3 class="form-title">
          <i class="fas fa-edit"></i>
          <span id="formTitle">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</span>
        </h3>
        
        <div class="product-type-selector" id="productTypeSelector">
          <div class="type-option active" data-type="personal" id="personalOption">
            <i class="fas fa-store"></i>
            <div>Ù…Ù†ØªØ¬ Ø´Ø®ØµÙŠ</div>
          </div>
          <div class="type-option" data-type="general" id="generalProductOption">
            <i class="fas fa-globe"></i>
            <div>Ù…Ù†ØªØ¬ Ø¹Ø§Ù…</div>
          </div>
        </div>
        
        <div class="form-group">
          <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:</label>
          <input type="text" id="pName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" required>
        </div>
        
        <div class="form-group">
          <label>Ø¨Ø§Ø±ÙƒÙˆØ¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
          <div class="barcode-field">
            <input type="text" id="pBarcode" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯" dir="ltr">
            <button class="btn-barcode" onclick="openScanner('form')" title="Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯">
              <i class="fas fa-camera"></i>
            </button>
            <button class="btn-barcode" onclick="openManualBarcode('form')" title="Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ">
              <i class="fas fa-keyboard"></i>
            </button>
          </div>
        </div>
        
        <div class="form-group">
          <label>Ø§Ù„Ø³Ø¹Ø± (Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø±Ø§Ù‚ÙŠ):</label>
          <input type="number" id="pPrice" step="0.01" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ø¹Ø±" required>
        </div>
        
        <div class="form-group">
          <label>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©:</label>
          <input type="number" id="pStock" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ…ÙŠØ©" required min="0">
        </div>
        
        <div class="form-group">
          <label>ÙØ¦Ø© Ø§Ù„Ù…Ù†ØªØ¬:</label>
          <div class="category-buttons">
            <div class="category-btn" data-category="food">ØºØ°Ø§Ø¦ÙŠØ©</div>
            <div class="category-btn" data-category="drinks">Ù…Ø´Ø±ÙˆØ¨Ø§Øª</div>
            <div class="category-btn" data-category="dairy">Ø£Ù„Ø¨Ø§Ù†</div>
            <div class="category-btn" data-category="cleaning">ØªÙ†Ø¸ÙŠÙ</div>
            <div class="category-btn" data-category="personal">Ø¹Ù†Ø§ÙŠØ© Ø´Ø®ØµÙŠØ©</div>
            <div class="category-btn active" data-category="other">Ø£Ø®Ø±Ù‰</div>
          </div>
          <input type="hidden" id="pCategory" value="other">
        </div>
        
        <div class="button-group">
          <button class="btn btn-primary" onclick="createOrUpdateProduct()">
            <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬
          </button>
          <button class="btn" onclick="clearForm()">
            <i class="fas fa-times"></i> Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
          </button>
        </div>
      </div>
    </div>
    
    <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
    <div id="settings" class="tab-content">
      <div class="settings-grid">
        <div class="settings-card">
          <h3 class="settings-title">
            <i class="fab fa-telegram"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ„Ø¬Ø±Ø§Ù…
          </h3>
          
          <div class="form-group">
            <label>Ù…Ø¹Ø±Ù Ø§Ù„Ø¨ÙˆØª (Bot Token):</label>
            <input type="password" id="telegramBotToken" placeholder="Ø£Ø¯Ø®Ù„ Token Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ">
            <small style="font-size: 11px; color: #7f8c8d;">Ù…Ø«Ø§Ù„: 1234567890:ABCdefGHIjklMNOpqrsTUVwxyz</small>
          </div>
          
          <div class="form-group">
            <label>Ù…Ø¹Ø±Ù Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© (Chat ID):</label>
            <input type="text" id="telegramChatId" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ">
            <small style="font-size: 11px; color: #7f8c8d;">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„ÙŠÙ‡ Ù…Ù† @userinfobot Ø¹Ù„Ù‰ Ø§Ù„ØªÙ„Ø¬Ø±Ø§Ù…</small>
          </div>
          
          <div id="botStatus" class="bot-status bot-disconnected">
            <i class="fas fa-circle"></i> Ø§Ù„Ø¨ÙˆØª ØºÙŠØ± Ù…ØªØµÙ„
          </div>
          
          <div class="button-group" style="margin-top: 15px;">
            <button class="btn btn-success" onclick="saveTelegramSettings()">
              <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </button>
            <button class="btn telegram-test" onclick="testTelegramConnection()">
              <i class="fab fa-telegram"></i> Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
            </button>
          </div>
        </div>
        
        <div class="settings-card">
          <h3 class="settings-title">
            <i class="fas fa-user"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨
          </h3>
          
          <div class="form-group">
            <label>Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±:</label>
            <input type="text" id="storeName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±">
          </div>
          
          <div class="form-group">
            <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
            <input type="email" id="userEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" readonly>
          </div>
          
          <button class="btn btn-primary" onclick="updateUserSettings()">
            <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø³Ø§Ø¨
          </button>
        </div>
        
        <div class="settings-card">
          <h3 class="settings-title">
            <i class="fas fa-cogs"></i> Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨
          </h3>
          
          <div class="button-group">
            <button class="btn btn-primary" onclick="loginWithEmail()">
              <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„/Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
            </button>
            <button class="btn btn-danger" onclick="logout()">
              <i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù†ØªØ¸Ø±Ø© (Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·) -->
    <div id="pending-products" class="tab-content">
      <h3 class="section-title">
        <i class="fas fa-clock"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù†ØªØ¸Ø±Ø© Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø© (<span id="pendingProductsCount">0</span>)
      </h3>
      
      <div class="products-grid" id="pendingProductsList">
        <div class="loading">
          <i class="fas fa-spinner"></i>
          <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù†ØªØ¸Ø±Ø©...</p>
        </div>
      </div>
    </div>
    
    <footer>
      <p>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø°ÙƒÙŠ Â© 2024</p>
      <p style="font-size: 11px; margin-top: 8px;" id="currentUser">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
    </footer>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ù…Ø§Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ -->
  <div class="modal-overlay" id="scannerModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">
          <i class="fas fa-barcode"></i> Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
        </h3>
        <button class="modal-close" onclick="closeScanner()">Ã—</button>
      </div>
      
      <div class="scanner-container">
        <video id="scanner-video" autoplay playsinline></video>
        <div class="scanner-overlay"></div>
      </div>
      
      <div class="scanner-stats">
        <div>Ø§Ù„Ù…Ø³Ø­: <span id="scannedCount">0</span></div>
        <div>Ø§Ù„Ø¯Ù‚Ø©: <span id="scanAccuracy">0%</span></div>
      </div>
      
      <div class="scan-result result-info" id="scanResult">
        <div>
          <i class="fas fa-barcode"></i>
          <span>ÙˆØ¬Ù‘Ù‡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù†Ø­Ùˆ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù„Ù„Ù…Ø³Ø­</span>
        </div>
      </div>
      
      <div class="manual-input" id="manualInputSection">
        <input type="text" id="manualBarcodeInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙŠØ¯ÙˆÙŠØ§Ù‹" dir="ltr">
        <button class="btn btn-full btn-primary" onclick="processManualBarcode()">
          <i class="fas fa-check"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
        </button>
      </div>
      
      <div class="modal-actions">
        <button class="btn-modal" onclick="switchCamera()">
          <i class="fas fa-sync-alt"></i> ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
        </button>
        <button class="btn-modal" onclick="toggleManualInput()">
          <i class="fas fa-keyboard"></i> Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ
        </button>
        <button class="btn-modal btn-modal-primary" onclick="closeScanner()">
          <i class="fas fa-check"></i> Ø¥Ù†Ù‡Ø§Ø¡
        </button>
      </div>
    </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù†ØªØ¬ -->
  <div class="modal-overlay" id="importModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">
          <i class="fas fa-copy"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø¹Ø§Ù…
        </h3>
        <button class="modal-close" onclick="closeImportModal()">Ã—</button>
      </div>
      
      <div class="form-group">
        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:</label>
        <input type="text" id="importName" readonly>
      </div>
      
      <div class="form-group">
        <label>Ø¨Ø§Ø±ÙƒÙˆØ¯:</label>
        <input type="text" id="importBarcode" readonly dir="ltr">
      </div>
      
      <div class="form-group">
        <label>Ø§Ù„Ø³Ø¹Ø± (Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø±Ø§Ù‚ÙŠ):</label>
        <input type="number" id="importPrice" step="0.01" placeholder="Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬" required>
      </div>
      
      <div class="form-group">
        <label>Ø§Ù„ÙƒÙ…ÙŠØ©:</label>
        <input type="number" id="importStock" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ…ÙŠØ©" required min="0">
      </div>
      
      <div class="button-group">
        <button class="btn btn-success" onclick="confirmImport()">
          <i class="fas fa-check"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯
        </button>
        <button class="btn" onclick="closeImportModal()">
          <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
        </button>
      </div>
    </div>
  </div>

  <!-- ØµÙˆØª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ -->
  <audio id="beepSound" preload="auto">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" type="audio/mpeg">
  </audio>
  
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
    import { getDatabase, ref, get, child, push, set, update, remove } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-database.js";
    import { 
      getAuth, 
      onAuthStateChanged, 
      signInAnonymously, 
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      signOut 
    } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-auth.js";

    // ØªÙƒÙˆÙŠÙ† Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAG4EKrB3iLEV2hsB8b08ShpSO6PXDnGjg",
      authDomain: "zio3-8ffdd.firebaseapp.com",
      databaseURL: "https://zio3-8ffdd-default-rtdb.firebaseio.com",
      projectId: "zio3-8ffdd",
      storageBucket: "zio3-8ffdd.firebasestorage.app",
      messagingSenderId: "560939348415",
      appId: "1:560939348415:web:c854e9e214e498ad2d310a",
      measurementId: "G-CVN2B2D0RD"
    };
    
    // ØªÙ‡ÙŠØ¦Ø© Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);
    
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
    const ADMIN_EMAIL = 'ashlhl.iq@gmail.com';
    
    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
    let currentUser = null;
    let isAdmin = false;
    let editingId = null;
    let productType = 'personal';
    let myProducts = {};
    let generalProducts = {};
    let pendingProducts = {};
    let productToImport = null;
    let scannerMode = '';
    let scannerActive = false;
    let currentStream = null;
    let facingMode = 'environment';
    let manualInputVisible = false;

    // Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        await handleUserSession(user);
      } else {
        try {
          // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¬Ù‡ÙˆÙ„ ÙƒØ­Ø§Ù„Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
          await signInAnonymously(auth);
        } catch (error) {
          console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¬Ù‡ÙˆÙ„:', error);
          showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.', 'error');
        }
      }
    });

    // Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    async function handleUserSession(user) {
      try {
        const userRef = ref(db, `users/${user.uid}`);
        const userSnap = await get(userRef);
        
        if (userSnap.exists()) {
          // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ - ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡
          const userData = userSnap.val();
          currentUser = {
            uid: user.uid,
            email: user.email || userData.email || 'Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¬Ù‡ÙˆÙ„',
            storeName: userData.storeName || (user.email ? user.email.split('@')[0] : 'Ù…ØªØ¬Ø±ÙŠ'),
            telegramChatId: userData.telegramChatId || '',
            telegramBotToken: userData.telegramBotToken || '',
            isAdmin: user.email === ADMIN_EMAIL,
            createdAt: userData.createdAt || Date.now()
          };
        } else {
          // Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ - Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
          let storeName = 'Ù…ØªØ¬Ø±ÙŠ';
          
          if (!user.email) {
            // Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¬Ù‡ÙˆÙ„ - Ø·Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±
            storeName = prompt('Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø°ÙƒÙŠ!\n\nØ£Ø¯Ø®Ù„ Ø§Ø³Ù… Ù…ØªØ¬Ø±Ùƒ:', 'Ù…ØªØ¬Ø±ÙŠ') || 'Ù…ØªØ¬Ø±ÙŠ';
          } else {
            // Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
            storeName = user.email.split('@')[0] || 'Ù…ØªØ¬Ø±ÙŠ';
          }
          
          currentUser = {
            uid: user.uid,
            email: user.email || 'Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¬Ù‡ÙˆÙ„',
            storeName: storeName,
            telegramChatId: '',
            telegramBotToken: '',
            isAdmin: user.email === ADMIN_EMAIL,
            createdAt: Date.now()
          };
          
          // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
          await set(userRef, currentUser);
        }
        
        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
        localStorage.setItem('inventory_user', JSON.stringify(currentUser));
        
        isAdmin = currentUser.isAdmin;
        updateUIForUser();
        await loadData();
        
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø©:', error);
        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…. ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.', 'error');
      }
    }

    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    function updateUIForUser() {
      if (!currentUser) return;
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±Ø­ÙŠØ¨
      const greeting = currentUser.email === 'Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¬Ù‡ÙˆÙ„' 
        ? `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${currentUser.storeName}` 
        : `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${currentUser.storeName} (${currentUser.email})`;
      
      document.getElementById('userGreeting').textContent = greeting;
      document.getElementById('currentUser').textContent = currentUser.email;
      
      // ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
      document.getElementById('storeName').value = currentUser.storeName;
      document.getElementById('userEmail').value = currentUser.email;
      
      // ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ„Ø¬Ø±Ø§Ù…
      if (currentUser.telegramBotToken) {
        document.getElementById('telegramBotToken').value = currentUser.telegramBotToken;
      }
      
      if (currentUser.telegramChatId) {
        document.getElementById('telegramChatId').value = currentUser.telegramChatId;
      }
      
      // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª
      updateBotStatus();
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø£Ùˆ Ø¥Ø®ÙØ§Ø¡ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù†ØªØ¸Ø±Ø© Ù„Ù„Ù…Ø¯ÙŠØ±
      const pendingTab = document.getElementById('pendingTab');
      const pendingCount = document.querySelector('.pending-count');
      
      if (isAdmin) {
        pendingTab.style.display = 'flex';
        if (pendingCount) {
          pendingCount.textContent = Object.keys(pendingProducts).length;
        }
      } else {
        pendingTab.style.display = 'none';
      }
      
      // ØªØ­Ø¯ÙŠØ« Ø´Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ±
      const roleBadge = document.getElementById('userRoleBadge');
      if (isAdmin) {
        roleBadge.innerHTML = '<span class="user-role role-admin"><i class="fas fa-crown"></i> Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</span>';
      } else {
        roleBadge.innerHTML = '<span class="user-role role-user"><i class="fas fa-user"></i> Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ</span>';
      }
      
      // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø± Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø¹Ø§Ù…
      const generalOption = document.getElementById('generalProductOption');
      if (isAdmin) {
        generalOption.innerHTML = '<i class="fas fa-globe"></i><div>Ù…Ù†ØªØ¬ Ø¹Ø§Ù… (Ù…Ø¯ÙŠØ±)</div>';
      } else {
        generalOption.innerHTML = '<i class="fas fa-globe"></i><div>Ù…Ù†ØªØ¬ Ø¹Ø§Ù… (ÙŠØ­ØªØ§Ø¬ Ù…ÙˆØ§ÙÙ‚Ø©)</div>';
      }
    }

    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø¨ÙˆØª Ø§Ù„ØªÙ„Ø¬Ø±Ø§Ù…
    function updateBotStatus() {
      const botStatus = document.getElementById('botStatus');
      const hasToken = currentUser.telegramBotToken && currentUser.telegramBotToken.trim() !== '';
      const hasChatId = currentUser.telegramChatId && currentUser.telegramChatId.trim() !== '';
      
      if (hasToken && hasChatId) {
        botStatus.innerHTML = '<i class="fas fa-circle"></i> Ø§Ù„Ø¨ÙˆØª Ù…ØªØµÙ„ ÙˆØ¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª';
        botStatus.className = 'bot-status bot-connected';
      } else {
        botStatus.innerHTML = '<i class="fas fa-circle"></i> Ø§Ù„Ø¨ÙˆØª ØºÙŠØ± Ù…ØªØµÙ„';
        botStatus.className = 'bot-status bot-disconnected';
      }
    }

    // Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ„Ø¬Ø±Ø§Ù…
    window.saveTelegramSettings = async function() {
      const botToken = document.getElementById('telegramBotToken').value.trim();
      const chatId = document.getElementById('telegramChatId').value.trim();
      
      if (!botToken) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Token Ø§Ù„Ø¨ÙˆØª', 'warning');
        return;
      }
      
      if (!chatId) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©', 'warning');
        return;
      }
      
      try {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Token Ø§Ù„Ø¨ÙˆØª
        if (!botToken.includes(':')) {
          showNotification('Token Ø§Ù„Ø¨ÙˆØª ØºÙŠØ± ØµØ§Ù„Ø­. ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ù†Ù‚Ø·ØªÙŠÙ† (:).', 'error');
          return;
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        currentUser.telegramBotToken = botToken;
        currentUser.telegramChatId = chatId;
        
        const userRef = ref(db, `users/${currentUser.uid}`);
        await update(userRef, {
          telegramBotToken: botToken,
          telegramChatId: chatId
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
        localStorage.setItem('inventory_user', JSON.stringify(currentUser));
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        updateBotStatus();
        showNotification('ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ„Ø¬Ø±Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
        
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ„Ø¬Ø±Ø§Ù…:', error);
        showNotification('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª: ' + error.message, 'error');
      }
    };

    // ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨
    window.updateUserSettings = async function() {
      const storeName = document.getElementById('storeName').value.trim();
      
      if (!storeName) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±', 'warning');
        return;
      }
      
      try {
        // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        currentUser.storeName = storeName;
        
        const userRef = ref(db, `users/${currentUser.uid}`);
        await update(userRef, {
          storeName: storeName
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
        localStorage.setItem('inventory_user', JSON.stringify(currentUser));
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        document.getElementById('userGreeting').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${storeName}`;
        
        showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨:', error);
        showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª: ' + error.message, 'error');
      }
    };

    // Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Ø§Ù„ØªÙ„Ø¬Ø±Ø§Ù…
    window.testTelegramConnection = async function() {
      const botToken = document.getElementById('telegramBotToken').value.trim();
      const chatId = document.getElementById('telegramChatId').value.trim();
      
      if (!botToken || !chatId) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ„Ø¬Ø±Ø§Ù… Ø£ÙˆÙ„Ø§Ù‹ ÙˆØ­ÙØ¸Ù‡Ø§', 'warning');
        return;
      }
      
      try {
        const message = `ğŸ”” Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø°ÙƒÙŠ\n\n`
          + `ğŸª Ø§Ù„Ù…ØªØ¬Ø±: ${currentUser.storeName}\n`
          + `ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯: ${currentUser.email}\n`
          + `â° Ø§Ù„ÙˆÙ‚Øª: ${new Date().toLocaleString('ar-IQ')}\n\n`
          + `âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­ Ø¨Ø§Ù„Ø¨ÙˆØª`;
        
        const url = `https://api.telegram.org/bot${botToken}/sendMessage`;
        
        const response = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            chat_id: chatId,
            text: message,
            parse_mode: 'HTML'
          })
        });
        
        const data = await response.json();
        
        if (data.ok) {
          showNotification('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰ Ø§Ù„ØªÙ„Ø¬Ø±Ø§Ù…', 'success');
        } else {
          showNotification(`âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©. ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.\nØ§Ù„Ø®Ø·Ø£: ${data.description || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`, 'error');
        }
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙ„Ø¬Ø±Ø§Ù…:', error);
        showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…: ' + error.message, 'error');
      }
    };

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    async function loadData() {
      await loadMyProducts();
      await loadGeneralProducts();
      if (isAdmin) {
        await loadPendingProducts();
      }
    }

    // ØªØ­Ù…ÙŠÙ„ Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    async function loadMyProducts() {
      try {
        const snap = await get(ref(db, `stores/${currentUser.uid}/products`));
        myProducts = snap.exists() ? snap.val() : {};
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø±Ù ÙˆØ§Ù„Ù…ØµØ¯Ø± Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª
        Object.keys(myProducts).forEach(k => {
          if (myProducts[k]) {
            myProducts[k].id = k;
            myProducts[k].source = 'personal';
          }
        });
        
        renderMyProductsList();
        updateMyProductsStats();
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:', error);
        myProducts = {};
      }
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
    async function loadGeneralProducts() {
      try {
        const snap = await get(ref(db, 'general/products'));
        const allProducts = snap.exists() ? snap.val() : {};
        
        generalProducts = {};
        Object.keys(allProducts).forEach(k => {
          if (allProducts[k] && allProducts[k].status === 'approved') {
            generalProducts[k] = allProducts[k];
            generalProducts[k].id = k;
            generalProducts[k].source = 'general';
          }
        });
        
        renderGeneralProductsList();
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø¹Ø§Ù…:', error);
        generalProducts = {};
      }
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù†ØªØ¸Ø±Ø© (Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·)
    async function loadPendingProducts() {
      try {
        const snap = await get(ref(db, 'general/products'));
        const allProducts = snap.exists() ? snap.val() : {};
        
        pendingProducts = {};
        Object.keys(allProducts).forEach(k => {
          if (allProducts[k] && allProducts[k].status === 'pending') {
            pendingProducts[k] = allProducts[k];
            pendingProducts[k].id = k;
          }
        });
        
        document.getElementById('pendingProductsCount').textContent = Object.keys(pendingProducts).length;
        const pendingCount = document.querySelector('.pending-count');
        if (pendingCount) {
          pendingCount.textContent = Object.keys(pendingProducts).length;
        }
        renderPendingProductsList();
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù†ØªØ¸Ø±Ø©:', error);
        pendingProducts = {};
      }
    }

    // Ø¹Ø±Ø¶ Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    function renderMyProductsList() {
      const el = document.getElementById('myProductsList');
      const searchTerm = document.getElementById('searchMyProducts').value.toLowerCase();
      
      let products = Object.values(myProducts).filter(p => p);
      
      // Ø§Ù„Ø¨Ø­Ø«
      if (searchTerm) {
        products = products.filter(p => 
          (p.name && p.name.toLowerCase().includes(searchTerm)) ||
          (p.barcode && p.barcode.toLowerCase().includes(searchTerm)) ||
          (p.category && p.category.toLowerCase().includes(searchTerm))
        );
      }
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      document.getElementById('myProductsCount').textContent = products.length;
      document.getElementById('myTotalProducts').textContent = products.length;
      
      if (products.length === 0) {
        if (searchTerm) {
          el.innerHTML = '<div class="empty-state"><i class="fas fa-search"></i><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ø¨Ø­Ø«Ùƒ</p></div>';
        } else {
          el.innerHTML = '<div class="empty-state"><i class="fas fa-box-open"></i><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯. Ø£Ø¶Ù Ø£ÙˆÙ„ Ù…Ù†ØªØ¬!</p></div>';
        }
        return;
      }
      
      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø°Ø§Øª Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø©
      let lowStockCount = 0;
      el.innerHTML = '';
      
      products.forEach(p => {
        const stock = parseInt(p.stock || 0);
        let stockClass = 'stock-gray';
        
        if (stock > 20) stockClass = 'stock-green';
        else if (stock > 5) stockClass = 'stock-yellow';
        else if (stock > 0) stockClass = 'stock-red';
        
        if (stock > 0 && stock <= 5) lowStockCount++;
        
        const div = document.createElement('div');
        div.className = 'product-card';
        div.innerHTML = `
          <div class="product-source source-personal">${currentUser.storeName}</div>
          <div class="product-header">
            <div class="product-name">${p.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</div>
            <div class="product-stock ${stockClass}">${stock}</div>
          </div>
          <div class="product-price">${(p.price || 0).toLocaleString()} Ø¯.Ø¹</div>
          <div class="product-barcode">${p.barcode || 'Ø¨Ø¯ÙˆÙ† Ø¨Ø§Ø±ÙƒÙˆØ¯'}</div>
          <div class="store-name">
            <i class="fas fa-tag"></i>
            <span>${getCategoryName(p.category)}</span>
          </div>
          <div class="product-actions">
            <button class="btn-action btn-action-primary" onclick="editProduct('${p.id}', 'personal')" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬">
              <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
            </button>
            <button class="btn-action btn-action-warning" onclick="adjustStock('${p.id}', 'personal')" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙ…ÙŠØ©">
              <i class="fas fa-exchange-alt"></i> ÙƒÙ…ÙŠØ©
            </button>
            <button class="btn-action" onclick="deleteProduct('${p.id}', 'personal')" title="Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬">
              <i class="fas fa-trash"></i> Ø­Ø°Ù
            </button>
          </div>
        `;
        el.appendChild(div);
      });
      
      document.getElementById('myLowStockCount').textContent = lowStockCount;
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
    function renderGeneralProductsList() {
      const el = document.getElementById('generalProductsList');
      const searchTerm = document.getElementById('searchGeneralProducts').value.toLowerCase();
      
      let products = Object.values(generalProducts).filter(p => p);
      
      // Ø§Ù„Ø¨Ø­Ø«
      if (searchTerm) {
        products = products.filter(p => 
          (p.name && p.name.toLowerCase().includes(searchTerm)) ||
          (p.barcode && p.barcode.toLowerCase().includes(searchTerm)) ||
          (p.category && p.category.toLowerCase().includes(searchTerm))
        );
      }
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      document.getElementById('generalProductsCount').textContent = products.length;
      document.getElementById('generalTotalProducts').textContent = products.length;
      
      if (products.length === 0) {
        if (searchTerm) {
          el.innerHTML = '<div class="empty-state"><i class="fas fa-search"></i><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø¹Ø§Ù…Ø© ØªØ·Ø§Ø¨Ù‚ Ø¨Ø­Ø«Ùƒ</p></div>';
        } else {
          el.innerHTML = '<div class="empty-state"><i class="fas fa-warehouse"></i><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø¹Ø§Ù…Ø© Ø¨Ø¹Ø¯</p></div>';
        }
        return;
      }
      
      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
      let popularCount = 0;
      el.innerHTML = '';
      
      products.forEach(p => {
        if (p.usageCount && p.usageCount > 10) popularCount++;
        
        const div = document.createElement('div');
        div.className = 'product-card';
        div.innerHTML = `
          <div class="product-source source-general">Ù…Ù†ØªØ¬ Ø¹Ø§Ù…</div>
          <div class="store-name">
            <i class="fas fa-store"></i>
            <span>${p.storeName || 'Ù…Ø®Ø²Ù† Ø¹Ø§Ù…'}</span>
          </div>
          <div class="product-header">
            <div class="product-name">${p.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</div>
          </div>
          <div class="product-barcode">${p.barcode || 'Ø¨Ø¯ÙˆÙ† Ø¨Ø§Ø±ÙƒÙˆØ¯'}</div>
          <div class="store-name">
            <i class="fas fa-tag"></i>
            <span>${getCategoryName(p.category)}</span>
            ${p.usageCount ? `<span style="margin-right: 10px;"><i class="fas fa-download"></i> ${p.usageCount}</span>` : ''}
          </div>
          <div class="product-actions">
            <button class="btn-action btn-action-success" onclick="showImportModal('${p.id}')" title="Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ù…Ø®Ø²ÙˆÙ†Ùƒ">
              <i class="fas fa-copy"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯
            </button>
          </div>
        `;
        el.appendChild(div);
      });
      
      document.getElementById('generalPopularCount').textContent = popularCount;
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù†ØªØ¸Ø±Ø© (Ù„Ù„Ù…Ø¯ÙŠØ±)
    function renderPendingProductsList() {
      const el = document.getElementById('pendingProductsList');
      const products = Object.values(pendingProducts);
      
      if (products.length === 0) {
        el.innerHTML = '<div class="empty-state"><i class="fas fa-clock"></i><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</p></div>';
        return;
      }
      
      el.innerHTML = '';
      
      products.forEach(p => {
        const div = document.createElement('div');
        div.className = 'product-card';
        div.innerHTML = `
          <div class="product-source source-pending">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</div>
          <div class="store-name">
            <i class="fas fa-store"></i>
            <span>${p.storeName || 'Ù…ØªØ¬Ø± ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</span>
          </div>
          <div class="product-header">
            <div class="product-name">${p.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</div>
          </div>
          <div class="product-barcode">${p.barcode || 'Ø¨Ø¯ÙˆÙ† Ø¨Ø§Ø±ÙƒÙˆØ¯'}</div>
          <div class="store-name">
            <i class="fas fa-tag"></i>
            <span>${getCategoryName(p.category)}</span>
          </div>
          <div class="product-price">${(p.price || 0).toLocaleString()} Ø¯.Ø¹</div>
          <div class="product-actions">
            <button class="btn-action btn-action-success" onclick="approveProduct('${p.id}')" title="Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬">
              <i class="fas fa-check"></i> Ù‚Ø¨ÙˆÙ„
            </button>
            <button class="btn-action btn-action-warning" onclick="rejectProduct('${p.id}')" title="Ø±ÙØ¶ Ø§Ù„Ù…Ù†ØªØ¬">
              <i class="fas fa-times"></i> Ø±ÙØ¶
            </button>
          </div>
        `;
        el.appendChild(div);
      });
    }

    // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    function updateMyProductsStats() {
      const products = Object.values(myProducts);
      document.getElementById('myProductsCount').textContent = products.length;
      document.getElementById('myTotalProducts').textContent = products.length;
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
    function initTabs() {
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          
          btn.classList.add('active');
          document.getElementById(btn.dataset.tab).classList.add('active');
        });
      });
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙØ¦Ø§Øª
    function initCategoryButtons() {
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          document.getElementById('pCategory').value = this.dataset.category;
        });
      });
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø®ÙŠØ§Ø±Ø§Øª Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬
    function initProductTypeOptions() {
      const personalOption = document.getElementById('personalOption');
      const generalOption = document.getElementById('generalProductOption');
      
      if (personalOption) {
        personalOption.addEventListener('click', function() {
          selectProductType('personal');
        });
      }
      
      if (generalOption) {
        generalOption.addEventListener('click', function() {
          selectProductType('general');
        });
      }
    }

    // Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬
    window.selectProductType = function(type) {
      if (type === 'general') {
        if (!currentUser) {
          showNotification('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'warning');
          return;
        }
        
        if (!isAdmin) {
          showNotification('Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¹Ø§Ø¯ÙŠÙŠÙ†: Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ØªØ­ØªØ§Ø¬ Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø¯ÙŠØ±', 'info');
        }
      }
      
      productType = type;
      
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
      document.querySelectorAll('.type-option').forEach(opt => {
        opt.classList.remove('active');
      });
      
      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ø´Ø§Ø· Ù„Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯
      const optionToActivate = document.querySelector(`.type-option[data-type="${type}"]`);
      if (optionToActivate) {
        optionToActivate.classList.add('active');
      }
      
      // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
      const formTitle = document.getElementById('formTitle');
      if (!editingId) {
        if (type === 'personal') {
          formTitle.textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø´Ø®ØµÙŠ';
        } else {
          formTitle.textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¹Ø§Ù…' + (isAdmin ? ' (Ù…Ø¯ÙŠØ±)' : ' (ÙŠØ­ØªØ§Ø¬ Ù…ÙˆØ§ÙÙ‚Ø©)');
        }
      }
    };

    // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ùˆ ØªØ­Ø¯ÙŠØ« Ù…Ù†ØªØ¬
    window.createOrUpdateProduct = async function() {
      const name = document.getElementById('pName').value.trim();
      const price = parseFloat(document.getElementById('pPrice').value);
      const stock = parseInt(document.getElementById('pStock').value);
      const barcode = document.getElementById('pBarcode').value.trim();
      const category = document.getElementById('pCategory').value;
      
      if (!name || !price || stock < 0) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­', 'warning');
        return;
      }

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      if (!currentUser || !currentUser.uid) {
        showNotification('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'warning');
        return;
      }
      
      const productData = {
        name,
        price,
        stock,
        barcode: barcode || '',
        category,
        storeName: currentUser.storeName,
        addedBy: currentUser.uid,
        updatedAt: Date.now()
      };
      
      try {
        if (editingId) {
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø­Ø§Ù„ÙŠ
          if (productType === 'personal') {
            await update(ref(db, `stores/${currentUser.uid}/products/${editingId}`), productData);
            showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø´Ø®ØµÙŠ Ø¨Ù†Ø¬Ø§Ø­', 'success');
          } else {
            if (!isAdmin) {
              showNotification('ÙÙ‚Ø· Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠÙ…ÙƒÙ†Ù‡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©', 'error');
              return;
            }
            await update(ref(db, `general/products/${editingId}`), productData);
            showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø¹Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
          }
        } else {
          // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
          productData.createdAt = Date.now();
          
          if (productType === 'personal') {
            // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø´Ø®ØµÙŠ
            const newRef = await push(ref(db, `stores/${currentUser.uid}/products`));
            await set(newRef, productData);
            showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø´Ø®ØµÙŠ Ø¨Ù†Ø¬Ø§Ø­', 'success');
          } else {
            // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¹Ø§Ù…
            productData.status = isAdmin ? 'approved' : 'pending';
            productData.usageCount = 0;
            
            const newRef = await push(ref(db, 'general/products'));
            await set(newRef, productData);
            
            if (isAdmin) {
              showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø¹Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } else {
              showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø¹Ø§Ù… ÙˆØ³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø¯ÙŠØ±', 'info');
              
              // Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¯ÙŠØ± Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø¨ÙˆØª ØªÙ„Ø¬Ø±Ø§Ù…
              if (currentUser.telegramBotToken && currentUser.telegramChatId) {
                await notifyAdminAboutPendingProduct(name, barcode);
              }
            }
          }
        }
        
        clearForm();
        await loadData();
        
        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
        const targetTab = productType === 'personal' ? 'my-products' : 'general-store';
        const tabBtn = document.querySelector(`[data-tab="${targetTab}"]`);
        if (tabBtn) {
          tabBtn.click();
        }
        
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬:', error);
        showNotification('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬: ' + error.message, 'error');
      }
    };

    // ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬
    window.editProduct = function(id, type) {
      editingId = id;
      const products = type === 'personal' ? myProducts : generalProducts;
      const product = products[id];
      
      if (!product) return;
      
      // ØªØ­Ø¯ÙŠØ« Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬
      productType = type;
      
      // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù†ÙˆØ¹
      document.querySelectorAll('.type-option').forEach(opt => {
        opt.classList.remove('active');
      });
      
      const optionToActivate = document.querySelector(`.type-option[data-type="${type}"]`);
      if (optionToActivate) {
        optionToActivate.classList.add('active');
      }
      
      // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
      document.getElementById('pName').value = product.name || '';
      document.getElementById('pPrice').value = product.price || '';
      document.getElementById('pStock').value = product.stock || '';
      document.getElementById('pBarcode').value = product.barcode || '';
      
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.category === (product.category || 'other')) {
          btn.classList.add('active');
        }
      });
      document.getElementById('pCategory').value = product.category || 'other';
      
      // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
      const formTitle = type === 'personal' ? 'ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬ Ø´Ø®ØµÙŠ' : 'ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬ Ø¹Ø§Ù…';
      document.getElementById('formTitle').textContent = formTitle;
      
      // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
      document.querySelector('[data-tab="add-product"]').click();
    };

    // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙ…ÙŠØ©
    window.adjustStock = async function(id, type) {
      const products = type === 'personal' ? myProducts : generalProducts;
      const product = products[id];
      
      if (!product) return;
      
      const newStock = prompt(`ØªØ¹Ø¯ÙŠÙ„ ÙƒÙ…ÙŠØ© "${product.name}"\nØ§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${product.stock}\nØ£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:`, product.stock);
      
      if (newStock === null) return;
      
      const stock = parseInt(newStock);
      if (isNaN(stock) || stock < 0) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø©', 'warning');
        return;
      }
      
      try {
        if (type === 'personal') {
          await update(ref(db, `stores/${currentUser.uid}/products/${id}`), {
            stock: stock,
            updatedAt: Date.now()
          });
          showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        } else {
          if (!isAdmin) {
            showNotification('ÙÙ‚Ø· Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠÙ…ÙƒÙ†Ù‡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©', 'error');
            return;
          }
          await update(ref(db, `general/products/${id}`), {
            stock: stock,
            updatedAt: Date.now()
          });
          showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }
        
        await loadData();
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ©:', error);
        showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ©: ' + error.message, 'error');
      }
    };

    // Ø­Ø°Ù Ù…Ù†ØªØ¬
    window.deleteProduct = async function(id, type) {
      if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.')) return;
      
      try {
        if (type === 'personal') {
          await remove(ref(db, `stores/${currentUser.uid}/products/${id}`));
          delete myProducts[id];
        } else {
          if (!isAdmin) {
            showNotification('ÙÙ‚Ø· Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠÙ…ÙƒÙ†Ù‡ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©', 'error');
            return;
          }
          await remove(ref(db, `general/products/${id}`));
          delete generalProducts[id];
        }
        
        showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        loadData();
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬:', error);
        showNotification('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬: ' + error.message, 'error');
      }
    };

    // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù†ØªØ¬
    window.showImportModal = function(id) {
      const product = generalProducts[id];
      if (!product) return;
      
      productToImport = product;
      document.getElementById('importName').value = product.name || '';
      document.getElementById('importBarcode').value = product.barcode || '';
      document.getElementById('importModal').style.display = 'flex';
    };

    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯
    window.closeImportModal = function() {
      document.getElementById('importModal').style.display = 'none';
      productToImport = null;
    };

    // ØªØ£ÙƒÙŠØ¯ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù†ØªØ¬
    window.confirmImport = async function() {
      if (!productToImport) return;
      
      const price = parseFloat(document.getElementById('importPrice').value);
      const stock = parseInt(document.getElementById('importStock').value);
      
      if (!price || isNaN(price) || price <= 0) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± ØµØ­ÙŠØ­', 'warning');
        return;
      }
      
      if (!stock || isNaN(stock) || stock < 0) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø©', 'warning');
        return;
      }
      
      const importedProduct = {
        name: productToImport.name,
        barcode: productToImport.barcode || '',
        price: price,
        stock: stock,
        category: productToImport.category || 'other',
        importedFrom: productToImport.id,
        storeName: currentUser.storeName,
        addedBy: currentUser.uid,
        createdAt: Date.now(),
        updatedAt: Date.now()
      };
      
      try {
        const newRef = await push(ref(db, `stores/${currentUser.uid}/products`));
        await set(newRef, importedProduct);
        
        // Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
        const newUsageCount = (productToImport.usageCount || 0) + 1;
        await update(ref(db, `general/products/${productToImport.id}`), {
          usageCount: newUsageCount
        });
        
        showNotification('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰ Ù…Ø®Ø²ÙˆÙ†Ùƒ', 'success');
        closeImportModal();
        loadMyProducts();
        loadGeneralProducts();
        
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù†ØªØ¬:', error);
        showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù†ØªØ¬: ' + error.message, 'error');
      }
    };

    // Ù‚Ø¨ÙˆÙ„ Ù…Ù†ØªØ¬ (Ù„Ù„Ù…Ø¯ÙŠØ±)
    window.approveProduct = async function(id) {
      if (!isAdmin) return;
      
      try {
        await update(ref(db, `general/products/${id}`), {
          status: 'approved',
          approvedAt: Date.now()
        });
        
        showNotification('ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        loadPendingProducts();
        loadGeneralProducts();
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬:', error);
        showNotification('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬: ' + error.message, 'error');
      }
    };

    // Ø±ÙØ¶ Ù…Ù†ØªØ¬ (Ù„Ù„Ù…Ø¯ÙŠØ±)
    window.rejectProduct = async function(id) {
      if (!isAdmin) return;
      
      try {
        await remove(ref(db, `general/products/${id}`));
        showNotification('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        loadPendingProducts();
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¶ Ø§Ù„Ù…Ù†ØªØ¬:', error);
        showNotification('Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¶ Ø§Ù„Ù…Ù†ØªØ¬: ' + error.message, 'error');
      }
    };

    // Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    window.clearForm = function() {
      editingId = null;
      document.getElementById('pName').value = '';
      document.getElementById('pPrice').value = '';
      document.getElementById('pStock').value = '';
      document.getElementById('pBarcode').value = '';
      
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.category === 'other') {
          btn.classList.add('active');
        }
      });
      document.getElementById('pCategory').value = 'other';
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø®ØµÙŠ
      productType = 'personal';
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù†ÙˆØ¹
      document.querySelectorAll('.type-option').forEach(opt => {
        opt.classList.remove('active');
      });
      
      const personalOption = document.getElementById('personalOption');
      if (personalOption) {
        personalOption.classList.add('active');
      }
      
      document.getElementById('formTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯';
    };

    // ÙØªØ­ Ù…Ø§Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
    window.openScanner = async function(mode) {
      scannerMode = mode;
      document.getElementById('scannerModal').style.display = 'flex';
      manualInputVisible = false;
      document.getElementById('manualInputSection').style.display = 'none';
      
      document.getElementById('scanResult').className = 'scan-result result-info';
      document.getElementById('scanResult').innerHTML = `
        <div>
          <i class="fas fa-barcode"></i>
          <span>ÙˆØ¬Ù‘Ù‡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù†Ø­Ùˆ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</span>
        </div>
      `;
      document.getElementById('scannedCount').textContent = '0';
      document.getElementById('scanAccuracy').textContent = '0%';
      
      try {
        await startCamera();
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§:', error);
        showScanResult('Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§.', 'error');
      }
    };
    
    // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
    async function startCamera() {
      if (currentStream) {
        stopCamera();
      }
      
      const constraints = {
        video: {
          facingMode: facingMode,
          width: { ideal: 1280 },
          height: { ideal: 720 }
        },
        audio: false
      };
      
      try {
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        currentStream = stream;
        const videoElement = document.getElementById('scanner-video');
        videoElement.srcObject = stream;
        scannerActive = true;
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§:', error);
        showScanResult('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§.', 'error');
      }
    }
    
    // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
    function stopCamera() {
      if (currentStream) {
        currentStream.getTracks().forEach(track => track.stop());
        currentStream = null;
      }
      scannerActive = false;
    }
    
    // ØªØ¨Ø¯ÙŠÙ„ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ
    window.toggleManualInput = function() {
      manualInputVisible = !manualInputVisible;
      const manualSection = document.getElementById('manualInputSection');
      manualSection.style.display = manualInputVisible ? 'block' : 'none';
      
      if (manualInputVisible) {
        document.getElementById('manualBarcodeInput').focus();
      }
    };
    
    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù…Ø¯Ø®Ù„ ÙŠØ¯ÙˆÙŠØ§Ù‹
    window.processManualBarcode = function() {
      const barcode = document.getElementById('manualBarcodeInput').value.trim();
      
      if (!barcode) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø§Ø±ÙƒÙˆØ¯', 'warning');
        return;
      }
      
      processBarcodeResult(barcode);
      document.getElementById('manualBarcodeInput').value = '';
    };
    
    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
    function processBarcodeResult(barcode) {
      document.getElementById('scannedCount').textContent = '1';
      document.getElementById('scanAccuracy').textContent = '100%';
      
      showScanResult(`ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: ${barcode}`, 'success');
      playBeepSound();
      
      setTimeout(() => {
        useBarcode(barcode);
      }, 1000);
    }
    
    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
    function useBarcode(barcode) {
      switch (scannerMode) {
        case 'form':
          document.getElementById('pBarcode').value = barcode;
          closeScanner();
          break;
          
        case 'search-my':
          document.getElementById('searchMyProducts').value = barcode;
          renderMyProductsList();
          closeScanner();
          break;
          
        case 'search-general':
          document.getElementById('searchGeneralProducts').value = barcode;
          renderGeneralProductsList();
          closeScanner();
          break;
      }
    }
    
    // Ø¹Ø±Ø¶ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø³Ø­
    function showScanResult(message, type = 'info') {
      const resultEl = document.getElementById('scanResult');
      let icon = 'fa-barcode';
      let className = 'result-info';
      
      if (type === 'success') {
        icon = 'fa-check-circle';
        className = 'result-success';
      } else if (type === 'error') {
        icon = 'fa-exclamation-circle';
        className = 'result-error';
      }
      
      resultEl.className = `scan-result ${className}`;
      resultEl.innerHTML = `
        <div>
          <i class="fas ${icon}"></i>
          <span>${message}</span>
        </div>
      `;
    }
    
    // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
    function playBeepSound() {
      const beepSound = document.getElementById('beepSound');
      if (beepSound) {
        beepSound.currentTime = 0;
        beepSound.play().catch(e => console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:', e));
      }
    }
    
    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø§Ø³Ø­
    window.closeScanner = function() {
      stopCamera();
      document.getElementById('scannerModal').style.display = 'none';
      scannerActive = false;
    };
    
    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
    window.switchCamera = function() {
      facingMode = facingMode === 'environment' ? 'user' : 'environment';
      startCamera();
    };
    
    // ÙØªØ­ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù„Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
    window.openManualBarcode = function(mode) {
      scannerMode = mode;
      document.getElementById('scannerModal').style.display = 'flex';
      manualInputVisible = true;
      document.getElementById('manualInputSection').style.display = 'block';
      document.getElementById('manualBarcodeInput').value = '';
      document.getElementById('manualBarcodeInput').focus();
      
      stopCamera();
      
      document.getElementById('scanResult').className = 'scan-result result-info';
      document.getElementById('scanResult').innerHTML = `
        <div>
          <i class="fas fa-keyboard"></i>
          <span>Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙŠØ¯ÙˆÙŠØ§Ù‹</span>
        </div>
      `;
    };

    // Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¯ÙŠØ± Ø¹Ù† Ù…Ù†ØªØ¬ Ù…Ù†ØªØ¸Ø±
    async function notifyAdminAboutPendingProduct(productName, barcode) {
      try {
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ±
        const adminRef = ref(db, 'users');
        const snapshot = await get(adminRef);
        const users = snapshot.val();
        
        let adminUser = null;
        for (const uid in users) {
          if (users[uid] && users[uid].email === ADMIN_EMAIL) {
            adminUser = users[uid];
            break;
          }
        }
        
        if (adminUser && adminUser.telegramBotToken && adminUser.telegramChatId) {
          const message = `ğŸ†• Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ ÙŠÙ†ØªØ¸Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©\n\n`
            + `ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬: ${productName}\n`
            + `ğŸ“‹ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: ${barcode || 'Ø¨Ø¯ÙˆÙ† Ø¨Ø§Ø±ÙƒÙˆØ¯'}\n`
            + `ğŸª Ø§Ù„Ù…ØªØ¬Ø±: ${currentUser.storeName}\n`
            + `ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯: ${currentUser.email}\n`
            + `â° Ø§Ù„ÙˆÙ‚Øª: ${new Date().toLocaleString('ar-IQ')}`;
          
          const url = `https://api.telegram.org/bot${adminUser.telegramBotToken}/sendMessage`;
          
          await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              chat_id: adminUser.telegramChatId,
              text: message,
              parse_mode: 'HTML'
            })
          });
        }
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±:', error);
      }
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„ÙØ¦Ø©
    function getCategoryName(category) {
      const categories = {
        'food': 'ØºØ°Ø§Ø¦ÙŠØ©',
        'drinks': 'Ù…Ø´Ø±ÙˆØ¨Ø§Øª',
        'dairy': 'Ø£Ù„Ø¨Ø§Ù†',
        'cleaning': 'ØªÙ†Ø¸ÙŠÙ',
        'personal': 'Ø¹Ù†Ø§ÙŠØ© Ø´Ø®ØµÙŠØ©',
        'other': 'Ø£Ø®Ø±Ù‰'
      };
      return categories[category] || 'Ø£Ø®Ø±Ù‰';
    }

    // Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
    function showNotification(message, type = 'info') {
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
      const oldNotifications = document.querySelectorAll('.notification');
      oldNotifications.forEach(n => n.remove());
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯
      const notification = document.createElement('div');
      notification.className = `notification notification-${type}`;
      notification.innerHTML = `
        <div style="display: flex; align-items: center; gap: 10px;">
          <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
          <div>${message}</div>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†
      setTimeout(() => {
        if (notification.parentNode) {
          notification.style.opacity = '0';
          notification.style.transform = 'translateX(100%)';
          setTimeout(() => {
            if (notification.parentNode) {
              notification.parentNode.removeChild(notification);
            }
          }, 300);
        }
      }, 5000);
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
    window.loginWithEmail = async function() {
      const email = prompt('Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:');
      if (!email) return;
      
      const password = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:');
      if (!password) return;
      
      try {
        // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        await signInWithEmailAndPassword(auth, email, password);
        showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
        
        if (error.code === 'auth/user-not-found') {
          const confirmCreate = confirm('Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ØŸ');
          if (confirmCreate) {
            try {
              // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
              const userCredential = await createUserWithEmailAndPassword(auth, email, password);
              
              // Ø·Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±
              const storeName = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ù…ØªØ¬Ø±Ùƒ:', email.split('@')[0]) || email.split('@')[0];
              
              showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
              window.location.reload();
            } catch (createError) {
              console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨:', createError);
              showNotification('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨: ' + createError.message, 'error');
            }
          }
        } else if (error.code === 'auth/wrong-password') {
          showNotification('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
        } else {
          showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + error.message, 'error');
        }
      }
    };

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
    window.logout = async function() {
      if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) return;
      
      try {
        await signOut(auth);
        localStorage.removeItem('inventory_user');
        showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        setTimeout(() => {
          window.location.reload();
        }, 1500);
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬:', error);
        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬: ' + error.message, 'error');
      }
    };

    // ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    window.exportMyProducts = function() {
      const data = JSON.stringify(myProducts, null, 2);
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `Ù…Ù†ØªØ¬Ø§Øª_${currentUser.storeName}_${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
    };

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø¹Ø§Ù…
    window.syncWithGeneralStore = function() {
      loadGeneralProducts();
      showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø¹Ø§Ù…', 'success');
    };

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ø­Ø«
    document.getElementById('searchMyProducts').addEventListener('input', renderMyProductsList);
    document.getElementById('searchGeneralProducts').addEventListener('input', renderGeneralProductsList);
    
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ
    document.getElementById('manualBarcodeInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        processManualBarcode();
      }
    });

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
    function init() {
      initTabs();
      initCategoryButtons();
      initProductTypeOptions();
      
      // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ ESC
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          if (document.getElementById('scannerModal').style.display === 'flex') {
            closeScanner();
          }
          if (document.getElementById('importModal').style.display === 'flex') {
            closeImportModal();
          }
        }
      });
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
    window.onload = init;
  </script>
</body>
</html>