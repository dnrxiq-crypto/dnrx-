<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„ - Ù†Ø¸Ø§Ù… ÙƒØ§Ø´ÙŠØ±</title>
  <style>
    /* CSS Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: Arial, sans-serif;
      padding: 16px;
      background: #fff;
      color: #000;
      line-height: 1.5;
      font-size: 14px;
    }
    
    .container {
      max-width: 100%;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 2px solid #000;
    }
    
    h1 {
      font-size: 20px;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .subtitle {
      color: #666;
      font-size: 13px;
    }
    
    /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
    .welcome-section {
      background: #f9f9f9;
      border-right: 3px solid #000;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
    }
    
    .welcome-title {
      font-size: 16px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .welcome-text {
      color: #666;
      font-size: 13px;
      line-height: 1.6;
    }
    
    /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø´Ø¨ÙƒÙŠØ© Ù„Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹ */
    .grid-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }
    
    .grid-item {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 14px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .grid-item:hover {
      border-color: #000;
      transform: translateY(-2px);
    }
    
    .grid-icon {
      font-size: 28px;
      margin-bottom: 8px;
      color: #000;
      display: block;
    }
    
    .grid-title {
      font-size: 13px;
      font-weight: bold;
      margin-bottom: 4px;
    }
    
    .grid-desc {
      font-size: 11px;
      color: #666;
    }
    
    /* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }
    
    .stat-card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 14px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 4px;
    }
    
    .stat-label {
      color: #666;
      font-size: 12px;
    }
    
    /* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® */
    .time-section {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
    }
    
    .time-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
    
    .time-item {
      background: #f9f9f9;
      border: 1px solid #eee;
      border-radius: 6px;
      padding: 12px;
    }
    
    .time-label {
      font-size: 12px;
      color: #666;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .time-value {
      font-size: 14px;
      font-weight: bold;
    }
    
    /* Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø© */
    .activity-section {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
    }
    
    .section-title {
      font-size: 16px;
      margin-bottom: 16px;
      padding-bottom: 10px;
      border-bottom: 1px solid #000;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .activity-list {
      max-height: 180px;
      overflow-y: auto;
    }
    
    .activity-item {
      padding: 12px 0;
      border-bottom: 1px solid #eee;
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }
    
    .activity-item:last-child {
      border-bottom: none;
    }
    
    .activity-icon {
      width: 30px;
      height: 30px;
      background: #f5f5f5;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    
    .activity-content {
      flex: 1;
    }
    
    .activity-text {
      font-size: 13px;
      margin-bottom: 4px;
    }
    
    .activity-time {
      font-size: 11px;
      color: #666;
    }
    
    /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹Ø© */
    .quick-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .btn-quick {
      padding: 12px;
      border: 1px solid #000;
      border-radius: 6px;
      background: #fff;
      color: #000;
      font-size: 13px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s;
    }
    
    .btn-quick:hover {
      background: #f5f5f5;
    }
    
    .btn-primary {
      background: #000;
      color: #fff;
    }
    
    .btn-primary:hover {
      background: #333;
    }
    
    /* Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© */
    .btn-back {
      width: 100%;
      padding: 14px;
      border: 1px solid #000;
      border-radius: 6px;
      background: #fff;
      color: #000;
      font-size: 14px;
      cursor: pointer;
      margin-top: 16px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .btn-back:hover {
      background: #f5f5f5;
    }
    
    /* Ø­Ø§Ù„Ø§Øª Ø®Ø§ØµØ© */
    .empty-state {
      text-align: center;
      padding: 30px 16px;
      color: #666;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }
    
    /* Ø§Ù„ØªØ°ÙŠÙŠÙ„ */
    footer {
      text-align: center;
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid #ddd;
      color: #666;
      font-size: 12px;
    }
    
    /* Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ */
    @media (max-width: 350px) {
      .grid-container,
      .stats-grid,
      .time-grid,
      .quick-buttons {
        grid-template-columns: 1fr;
      }
      
      body {
        padding: 12px;
      }
    }
    
    /* Ø¥Ø¶Ø§ÙØ© ØªÙ†Ø³ÙŠÙ‚ Ù„Ù„Ø£Ø¯Ù…Ù† */
    .admin-panel-btn {
      background: #000;
      color: #fff;
    }
    
    .admin-panel-btn:hover {
      background: #333;
    }
    
    /* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
    .user-info {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      padding: 12px;
      background: #f9f9f9;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
    
    .user-details {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .user-email {
      font-weight: bold;
      color: #000;
    }
    
    .user-store {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }
    
    .user-role {
      background: #000;
      color: #fff;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .admin-crown {
      color: gold;
    }
    
    /* Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„ØµØºÙŠØ± */
    .logout-btn-small {
      background: transparent;
      border: none;
      color: #666;
      font-size: 20px;
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .logout-btn-small:hover {
      color: #c62828;
      background: #ffebee;
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-play-circle"></i> Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹</h1>
      <p class="subtitle">Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹ Ø¥Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</p>
    </header>
    
    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
    <div class="user-info" id="userInfo" style="display: none;">
      <div class="user-details">
        <div>
          <div class="user-email" id="userEmail">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
          <div class="user-store" id="userStore"></div>
        </div>
      </div>
      <div style="display: flex; align-items: center; gap: 10px;">
        <div class="user-role" id="userRole">
          <i class="fas fa-user"></i>
          <span>Ù…Ø³ØªØ®Ø¯Ù…</span>
        </div>
        <!-- Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„ØµØºÙŠØ± -->
        <button class="logout-btn-small" id="logoutBtn" title="ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬">
          <i class="fas fa-sign-out-alt"></i>
        </button>
      </div>
    </div>
    
    <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ -->
    <div class="welcome-section">
      <div class="welcome-title">
        <i class="fas fa-info-circle"></i> Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… ÙƒØ§Ø´ÙŠØ±
      </div>
      <div class="welcome-text" id="welcomeText">
        Ø§Ø®ØªØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ù‡Ø§. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ø³Ø±Ø¹Ø© Ø¨ÙŠÙ† Ù…Ø®ØªÙ„Ù Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ø¯Ù†Ø§Ù‡.
      </div>
    </div>
    
    <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø´Ø¨ÙƒÙŠØ© Ù„Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹ -->
    <div class="grid-container">
      <div class="grid-item" onclick="location.href='pos.html'">
        <i class="fas fa-shopping-cart grid-icon"></i>
        <div class="grid-title">Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</div>
        <div class="grid-desc">Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¹</div>
      </div>
      
      <div class="grid-item" onclick="location.href='inventory.html'">
        <i class="fas fa-boxes-stacked grid-icon"></i>
        <div class="grid-title">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</div>
        <div class="grid-desc">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
      </div>
      
      <div class="grid-item" onclick="location.href='reports.html'">
        <i class="fas fa-chart-line grid-icon"></i>
        <div class="grid-title">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
        <div class="grid-desc">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
      </div>
      
      <div class="grid-item" onclick="location.href='settings.html'">
        <i class="fas fa-cogs grid-icon"></i>
        <div class="grid-title">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
        <div class="grid-desc">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
      </div>
      
      <!-- Ø¨Ø·Ø§Ù‚Ø© Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† - ØªØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† -->
      <div class="grid-item" id="adminPanelBtn" onclick="location.href='admin.html'" style="display: none;">
        <i class="fas fa-user-shield grid-icon"></i>
        <div class="grid-title">Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</div>
        <div class="grid-desc">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
      </div>
    </div>
    
    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="totalProducts">0</div>
        <div class="stat-label">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-value" id="todaySales">0</div>
        <div class="stat-label">Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-value" id="lowStock">0</div>
        <div class="stat-label">Ù…Ù†Ø®ÙØ¶ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-value" id="monthRevenue">0</div>
        <div class="stat-label">Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±</div>
      </div>
    </div>
    
    <!-- Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® -->
    <div class="time-section">
      <div class="time-grid">
        <div class="time-item">
          <div class="time-label">
            <i class="fas fa-calendar-day"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…
          </div>
          <div class="time-value" id="currentDate"></div>
        </div>
        
        <div class="time-item">
          <div class="time-label">
            <i class="fas fa-clock"></i> Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
          </div>
          <div class="time-value" id="currentTime"></div>
        </div>
      </div>
    </div>
    
    <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
    <div class="quick-buttons">
      <button class="btn-quick btn-primary" onclick="location.href='pos.html'">
        <i class="fas fa-bolt"></i> Ø¨Ø¯Ø¡ Ø¨ÙŠØ¹ Ø³Ø±ÙŠØ¹
      </button>
      <button class="btn-quick" onclick="location.href='inventory.html'">
        <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬
      </button>
      <button class="btn-quick" onclick="window.print()">
        <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
      </button>
      <button class="btn-quick" onclick="backupNow()">
        <i class="fas fa-download"></i> Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ
      </button>
      <!-- Ø²Ø± Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† - ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† -->
      <button class="btn-quick admin-panel-btn" id="adminQuickBtn" onclick="location.href='admin.html'" style="display: none;">
        <i class="fas fa-user-shield"></i> Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†
      </button>
    </div>
    
    <!-- Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø© -->
    <div class="activity-section">
      <h3 class="section-title">
        <i class="fas fa-history"></i> Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©
      </h3>
      
      <div class="activity-list" id="activityList">
        <div class="activity-item">
          <div class="activity-icon">
            <i class="fas fa-info-circle"></i>
          </div>
          <div class="activity-content">
            <div class="activity-text">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª...</div>
            <div class="activity-time">Ø§Ù„Ø¢Ù†</div>
          </div>
        </div>
      </div>
    </div>
    
    <button class="btn-back" onclick="location.href='main.html'">
      <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    </button>
    
    <footer>
      <p>Ù†Ø¸Ø§Ù… ÙƒØ§Ø´ÙŠØ± - Ù„ÙˆØ­Ø© Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø±ÙŠØ¹ | Ø§Ù„Ø¥ØµØ¯Ø§Ø± 1.0</p>
    </footer>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-auth.js";
    import { getDatabase, ref, get, child, set } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-database.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAG4EKrB3iLEV2hsB8b08ShpSO6PXDnGjg",
      authDomain: "zio3-8ffdd.firebaseapp.com",
      databaseURL: "https://zio3-8ffdd-default-rtdb.firebaseio.com",
      projectId: "zio3-8ffdd",
      storageBucket: "zio3-8ffdd.firebasestorage.app",
      messagingSenderId: "560939348415",
      appId: "1:560939348415:web:c854e9e214e498ad2d310a",
      measurementId: "G-CVN2B2D0RD"
    };
    
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    const firestore = getFirestore(app);
    
    // Ù…ØªØºÙŠØ±Ø§Øª Ù„ØªØªØ¨Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ù…ØªØ¬Ø±
    let currentShopId = null;
    let currentUserData = null;
    let isRedirecting = false;

    // Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
    async function handleLogout() {
      if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
        try {
          await signOut(auth);
          localStorage.removeItem('dnrx_user');
          window.location.href = 'login.html';
        } catch (error) {
          console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬:', error);
          alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬');
        }
      }
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ­Ø§Ù„ØªÙ‡
    async function checkUserAndPermissions(user) {
      try {
        if (!user) return { isAdmin: false, approved: false };
        
        const userEmail = user.email;
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† localStorage Ø£ÙˆÙ„Ø§Ù‹
        const savedUser = localStorage.getItem('dnrx_user');
        if (savedUser) {
          try {
            const userData = JSON.parse(savedUser);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø¨ÙŠØ§Ù†Ø§Øª localStorage ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
            if (userData.email === user.email) {
              // ØªØ­Ø¯ÙŠØ¯ shopId Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
              let shopId = userData.shopId || userData.storeId;
              
              // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ shopIdØŒ Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø­Ø¯ ÙØ±ÙŠØ¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
              if (!shopId) {
                shopId = 'shop_' + user.email.replace(/[^a-zA-Z0-9]/g, '_');
                // ØªØ­Ø¯ÙŠØ« localStorage Ø¨Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                userData.shopId = shopId;
                localStorage.setItem('dnrx_user', JSON.stringify(userData));
              }
              
              currentShopId = shopId;
              currentUserData = userData;
              
              return { 
                isAdmin: userData.userType === 'admin', 
                approved: userData.approved === true || userData.approved === undefined,
                email: userEmail,
                storeName: userData.storeName || "Ù…ØªØ¬Ø±ÙŠ",
                shopId: shopId
              };
            }
          } catch (e) {
            console.warn('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª localStorage:', e);
            localStorage.removeItem('dnrx_user');
          }
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Firestore Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ localStorage
        const userRef = doc(firestore, "dnrx_users", user.uid);
        const userSnap = await getDoc(userRef);
        
        if (userSnap.exists()) {
          const userData = userSnap.data();
          
          // ØªØ­Ø¯ÙŠØ¯ shopId Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
          let shopId = userData.shopId || userData.storeId;
          
          // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ shopIdØŒ Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø­Ø¯ ÙØ±ÙŠØ¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
          if (!shopId) {
            shopId = 'shop_' + user.email.replace(/[^a-zA-Z0-9]/g, '_');
          }
          
          currentShopId = shopId;
          currentUserData = userData;
          
          // Ø­ÙØ¸ ÙÙŠ localStorage Ù„Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
          localStorage.setItem('dnrx_user', JSON.stringify({
            ...userData,
            uid: user.uid,
            email: user.email,
            shopId: shopId
          }));
          
          return { 
            isAdmin: userData.userType === "admin" || userEmail === "ashlhl.iq@gmail.com", 
            approved: userData.approved === true || userData.approved === undefined,
            email: userEmail,
            storeName: userData.storeName || "Ù…ØªØ¬Ø±ÙŠ",
            shopId: shopId
          };
        } else {
          // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø³Ø¬Ù„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ dnrx_usersØŒ Ø¥Ù†Ø´Ø§Ø¡ Ù…ØªØ¬Ø± Ø§ÙØªØ±Ø§Ø¶ÙŠ
          const shopId = 'shop_' + user.email.replace(/[^a-zA-Z0-9]/g, '_');
          
          currentShopId = shopId;
          currentUserData = {
            storeName: "Ù…ØªØ¬Ø±ÙŠ",
            email: user.email
          };
          
          return { 
            isAdmin: userEmail === "ashlhl.iq@gmail.com", 
            approved: true,
            email: userEmail,
            storeName: "Ù…ØªØ¬Ø±ÙŠ",
            shopId: shopId
          };
        }
        
      } catch (error) {
        console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:", error);
        return { 
          isAdmin: false, 
          approved: true, 
          email: user?.email || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
          storeName: "Ù…ØªØ¬Ø±ÙŠ",
          shopId: 'defaultShop'
        };
      }
    }

    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø­Ø³Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
    function updateUIForUser(userInfo) {
      const userInfoDiv = document.getElementById('userInfo');
      const userEmailSpan = document.getElementById('userEmail');
      const userStoreSpan = document.getElementById('userStore');
      const userRoleSpan = document.getElementById('userRole');
      const welcomeText = document.getElementById('welcomeText');
      const adminPanelBtn = document.getElementById('adminPanelBtn');
      const adminQuickBtn = document.getElementById('adminQuickBtn');
      const logoutBtn = document.getElementById('logoutBtn');
      
      if (userInfo.email) {
        userEmailSpan.textContent = userInfo.email;
        userInfoDiv.style.display = 'flex';
      }
      
      if (userInfo.storeName) {
        userStoreSpan.textContent = `Ø§Ù„Ù…ØªØ¬Ø±: ${userInfo.storeName}`;
      }
      
      // ØªØ­Ø¯ÙŠØ« Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ù„ØªØ¹ÙƒØ³ Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±
      if (welcomeText && userInfo.storeName) {
        welcomeText.innerHTML = `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…ØªØ¬Ø± <strong>${userInfo.storeName}</strong>. Ø§Ø®ØªØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ù‡Ø§. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ø³Ø±Ø¹Ø© Ø¨ÙŠÙ† Ù…Ø®ØªÙ„Ù Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ø¯Ù†Ø§Ù‡.`;
      }
      
      if (userInfo.isAdmin) {
        userRoleSpan.innerHTML = '<i class="fas fa-crown admin-crown"></i> <span>Ù…Ø³Ø¤ÙˆÙ„</span>';
        
        if (adminPanelBtn) adminPanelBtn.style.display = 'block';
        if (adminQuickBtn) adminQuickBtn.style.display = 'flex';
      } else {
        userRoleSpan.innerHTML = '<i class="fas fa-user"></i> <span>Ù…Ø³ØªØ®Ø¯Ù…</span>';
      }
      
      // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø± Ù„Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
      if (logoutBtn) {
        logoutBtn.addEventListener('click', handleLogout);
      }
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
    function updateDateTime() {
      const now = new Date();
      
      const dateOptions = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      };
      document.getElementById('currentDate').textContent = 
        now.toLocaleDateString('ar-SA', dateOptions);
      
      const timeOptions = {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false
      };
      document.getElementById('currentTime').textContent = 
        now.toLocaleTimeString('ar-SA', timeOptions);
    }

    // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
    setInterval(updateDateTime, 1000);
    updateDateTime();

    // Ø¥Ù†Ø´Ø§Ø¡ Ù…ØªØ¬Ø± Ø¬Ø¯ÙŠØ¯ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
    async function createShopIfNotExists(shopId, storeName, userEmail) {
      try {
        const shopRef = ref(db, `stores/${shopId}`);
        const shopSnap = await get(shopRef);
        
        if (!shopSnap.exists()) {
          // Ø¥Ù†Ø´Ø§Ø¡ Ù‡ÙŠÙƒÙ„ Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ù…ØªØ¬Ø±
          const shopData = {
            info: {
              createdAt: Date.now(),
              storeName: storeName || "Ù…ØªØ¬Ø±ÙŠ",
              ownerEmail: userEmail || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
              lastUpdated: Date.now()
            },
            settings: {
              currency: "Ø¯.Ø¹",
              taxRate: 0,
              language: "ar"
            }
          };
          
          await set(ref(db, `stores/${shopId}`), shopData);
          console.log("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…ØªØ¬Ø± Ø¬Ø¯ÙŠØ¯:", shopId);
        }
      } catch (error) {
        console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ØªØ¬Ø±:", error);
      }
    }

    // ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    async function loadProductStats() {
      if (!currentShopId) {
        console.warn('âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ shopId Ø¨Ø¹Ø¯');
        return;
      }
      
      try {
        const snap = await get(child(ref(db), `stores/${currentShopId}/products`));
        const products = snap.exists() ? snap.val() : {};
        const totalProducts = Object.keys(products).length;
        
        let lowStockCount = 0;
        Object.values(products).forEach(product => {
          const stock = parseInt(product.stock || 0);
          if (stock > 0 && stock < 10) {
            lowStockCount++;
          }
        });
        
        document.getElementById('totalProducts').textContent = totalProducts;
        document.getElementById('lowStock').textContent = lowStockCount;
        
        localStorage.setItem('products_' + currentShopId, JSON.stringify(products));
      } catch (e) {
        console.warn('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:', e);
        const local = localStorage.getItem('products_' + currentShopId);
        if (local) {
          const products = JSON.parse(local);
          const totalProducts = Object.keys(products).length;
          
          let lowStockCount = 0;
          Object.values(products).forEach(product => {
            const stock = parseInt(product.stock || 0);
            if (stock > 0 && stock < 10) {
              lowStockCount++;
            }
          });
          
          document.getElementById('totalProducts').textContent = totalProducts;
          document.getElementById('lowStock').textContent = lowStockCount;
        }
      }
    }

    // ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
    async function loadSalesStats() {
      if (!currentShopId) {
        console.warn('âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ shopId Ø¨Ø¹Ø¯');
        return;
      }
      
      try {
        const today = new Date();
        const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate()).getTime();
        const monthStart = new Date(today.getFullYear(), today.getMonth(), 1).getTime();
        
        const snap = await get(child(ref(db), `stores/${currentShopId}/sales`));
        
        let todaySalesCount = 0;
        let monthRevenue = 0;
        
        if (snap.exists()) {
          const sales = snap.val();
          
          Object.values(sales).forEach(sale => {
            const saleTime = sale.createdAt || 0;
            const saleTotal = Number(sale.total || 0);
            
            if (saleTime >= todayStart) {
              todaySalesCount++;
              monthRevenue += saleTotal;
            }
            
            if (saleTime >= monthStart) {
              monthRevenue += saleTotal;
            }
          });
        }
        
        document.getElementById('todaySales').textContent = todaySalesCount;
        document.getElementById('monthRevenue').textContent = monthRevenue.toFixed(0) + ' Ø¯.Ø¹';
        
        localStorage.setItem('salesStats_' + currentShopId, JSON.stringify({
          todaySales: todaySalesCount,
          monthRevenue: monthRevenue,
          lastUpdate: Date.now()
        }));
        
      } catch (e) {
        console.warn('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª:', e);
        const local = localStorage.getItem('salesStats_' + currentShopId);
        if (local) {
          const stats = JSON.parse(local);
          document.getElementById('todaySales').textContent = stats.todaySales || 0;
          document.getElementById('monthRevenue').textContent = (stats.monthRevenue || 0).toFixed(0) + ' Ø¯.Ø¹';
        }
      }
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©
    async function loadRecentActivities() {
      if (!currentShopId) {
        console.warn('âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ shopId Ø¨Ø¹Ø¯');
        return;
      }
      
      const activityListEl = document.getElementById('activityList');
      
      try {
        const salesSnap = await get(child(ref(db), `stores/${currentShopId}/sales`));
        
        const activities = [];
        
        if (salesSnap.exists()) {
          const sales = salesSnap.val();
          const saleEntries = Object.entries(sales);
          
          saleEntries.sort((a, b) => (b[1].createdAt || 0) - (a[1].createdAt || 0));
          
          saleEntries.slice(0, 3).forEach(([id, sale]) => {
            const saleDate = new Date(sale.createdAt || Date.now());
            const timeStr = saleDate.toLocaleTimeString('ar-SA', { 
              hour: '2-digit', 
              minute: '2-digit' 
            });
            
            let itemCount = 0;
            if (sale.items) {
              itemCount = Object.values(sale.items).reduce((sum, item) => sum + (item.qty || 0), 0);
            }
            
            activities.push({
              type: 'sale',
              icon: 'fas fa-shopping-cart',
              text: `ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹: ${itemCount} Ù…Ù†ØªØ¬ Ø¨Ù‚ÙŠÙ…Ø© ${Number(sale.total || 0).toFixed(2)} Ø¯.Ø¹`,
              time: timeStr
            });
          });
        }
        
        activities.push({
          type: 'system',
          icon: 'fas fa-info-circle',
          text: `ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø±ÙŠØ¹ Ù„Ù„Ù…ØªØ¬Ø±: ${currentUserData?.storeName || "Ù…ØªØ¬Ø±ÙŠ"}`,
          time: 'Ø§Ù„Ø¢Ù†'
        });
        
        activityListEl.innerHTML = '';
        
        activities.forEach(activity => {
          const activityDiv = document.createElement('div');
          activityDiv.className = 'activity-item';
          activityDiv.innerHTML = `
            <div class="activity-icon">
              <i class="${activity.icon}"></i>
            </div>
            <div class="activity-content">
              <div class="activity-text">${activity.text}</div>
              <div class="activity-time">${activity.time}</div>
            </div>
          `;
          activityListEl.appendChild(activityDiv);
        });
        
      } catch (e) {
        console.warn('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª:', e);
        activityListEl.innerHTML = `
          <div class="activity-item">
            <div class="activity-icon">
              <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="activity-content">
              <div class="activity-text">Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„.</div>
              <div class="activity-time">Ø§Ù„Ø¢Ù†</div>
            </div>
          </div>
        `;
      }
    }

    // Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙÙˆØ±ÙŠ
    window.backupNow = async function() {
      if (!currentShopId) {
        alert('âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ØªØ¬Ø± Ø¨Ø¹Ø¯');
        return;
      }
      
      try {
        const [productsSnap, salesSnap, settingsSnap] = await Promise.all([
          get(ref(db, `stores/${currentShopId}/products`)),
          get(ref(db, `stores/${currentShopId}/sales`)),
          get(ref(db, `stores/${currentShopId}/settings`))
        ]);

        const backupData = {
          timestamp: Date.now(),
          date: new Date().toLocaleString('ar-SA'),
          shopId: currentShopId,
          storeName: currentUserData?.storeName || "Ù…ØªØ¬Ø±ÙŠ",
          products: productsSnap.exists() ? productsSnap.val() : {},
          sales: salesSnap.exists() ? salesSnap.val() : {},
          settings: settingsSnap.exists() ? settingsSnap.val() : {}
        };

        localStorage.setItem('system_backup_' + currentShopId + '_' + Date.now(), JSON.stringify(backupData));
        
        const dataStr = JSON.stringify(backupData, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        const url = URL.createObjectURL(dataBlob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `backup_${currentShopId}_${new Date().toISOString().slice(0,10)}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­ âœ“');
        
        const activityList = document.getElementById('activityList');
        const now = new Date();
        const timeStr = now.toLocaleTimeString('ar-SA', { 
          hour: '2-digit', 
          minute: '2-digit' 
        });
        
        const backupActivity = document.createElement('div');
        backupActivity.className = 'activity-item';
        backupActivity.innerHTML = `
          <div class="activity-icon">
            <i class="fas fa-download"></i>
          </div>
          <div class="activity-content">
            <div class="activity-text">ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù„Ù„Ù…ØªØ¬Ø±: ${currentUserData?.storeName || "Ù…ØªØ¬Ø±ÙŠ"}</div>
            <div class="activity-time">${timeStr}</div>
          </div>
        `;
        
        activityList.insertBefore(backupActivity, activityList.firstChild);
        
      } catch (err) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ:', err);
        alert('ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„.');
      }
    };

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒÙ†Ø§ Ù‚Ø¯ Ù‚Ù…Ù†Ø§ Ø¨Ø§Ù„ÙØ¹Ù„ Ø¨ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        if (isRedirecting) {
          console.log('âœ… ÙŠØªÙ… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¨Ø§Ù„ÙØ¹Ù„ØŒ ØªØ®Ø·ÙŠ...');
          return;
        }
        
        const userInfo = await checkUserAndPermissions(user);
        
        // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¹ØªÙ…Ø¯Ù‹Ø§ØŒ Ù‚Ù… Ø¨ØªÙˆØ¬ÙŠÙ‡Ù‡
        if (userInfo.approved === false) {
          console.log('âŒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…Ø¹ØªÙ…Ø¯ØŒ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ pending.html');
          isRedirecting = true;
          window.location.href = 'pending.html';
          return;
        }
        
        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        updateUIForUser(userInfo);
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ØªØ¬Ø± Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
        await createShopIfNotExists(
          userInfo.shopId, 
          userInfo.storeName, 
          userInfo.email
        );
        
        updateDateTime();
        await loadProductStats();
        await loadSalesStats();
        await loadRecentActivities();
      } else {
        // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ù‚Ù… Ø¨ØªÙˆØ¬ÙŠÙ‡Ù‡ Ø¥Ù„Ù‰ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        if (!isRedirecting) {
          console.log('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ login.html');
          isRedirecting = true;
          window.location.href = 'login.html';
        }
      }
    });

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
    setInterval(async () => {
      if (currentShopId) {
        await loadProductStats();
        await loadSalesStats();
      }
    }, 30000);
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„ Ù…Ø±Ø©
    window.addEventListener('load', () => {
      console.log('ğŸš€ Ù„ÙˆØ­Ø© Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø±ÙŠØ¹ Ø¬Ø§Ù‡Ø²Ø©');
    });
  </script>
</body>
</html>