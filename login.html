<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Ù†Ø¸Ø§Ù… DNRX</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: Arial, sans-serif;
      padding: 16px;
      background: #fff;
      color: #000;
      line-height: 1.5;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    
    .container {
      max-width: 450px;
      width: 100%;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 2px solid #000;
    }
    
    h1 {
      font-size: 24px;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .subtitle {
      color: #666;
      font-size: 14px;
    }
    
    .login-card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 20px;
    }
    
    .form-group {
      margin-bottom: 18px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      font-size: 15px;
      border-radius: 6px;
      background: #fff;
    }
    
    input:focus {
      outline: none;
      border-color: #000;
    }
    
    .login-btn {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      background: #000;
      color: #fff;
      margin-top: 10px;
      transition: all 0.2s;
    }
    
    .login-btn:hover {
      background: #333;
    }
    
    .login-btn:disabled {
      background: #666;
      cursor: not-allowed;
    }
    
    .google-btn {
      width: 100%;
      padding: 14px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      background: #fff;
      color: #000;
      margin-top: 10px;
      transition: all 0.2s;
    }
    
    .google-btn:hover {
      background: #f5f5f5;
      border-color: #000;
    }
    
    .message {
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 16px;
      text-align: center;
      font-size: 13px;
      display: none;
    }
    
    .success {
      background: #e8f5e9;
      color: #2e7d32;
      border: 1px solid #c8e6c9;
    }
    
    .error {
      background: #ffebee;
      color: #c62828;
      border: 1px solid #ffcdd2;
    }
    
    .info {
      background: #e3f2fd;
      color: #1565c0;
      border: 1px solid #bbdefb;
    }
    
    .links {
      text-align: center;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }
    
    .link {
      color: #000;
      text-decoration: none;
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      margin: 0 10px;
      transition: color 0.2s;
    }
    
    .link:hover {
      color: #666;
      text-decoration: underline;
    }
    
    footer {
      text-align: center;
      margin-top: 25px;
      padding-top: 15px;
      border-top: 1px solid #ddd;
      color: #666;
      font-size: 12px;
    }
    
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @media (max-width: 480px) {
      body {
        padding: 12px;
      }
      
      .login-card {
        padding: 18px;
      }
      
      h1 {
        font-size: 20px;
      }
      
      .links {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
    }
    
    .divider {
      text-align: center;
      margin: 20px 0;
      position: relative;
    }
    
    .divider::before {
      content: "";
      position: absolute;
      top: 50%;
      right: 0;
      left: 0;
      height: 1px;
      background: #eee;
    }
    
    .divider span {
      background: #fff;
      padding: 0 15px;
      color: #666;
      font-size: 13px;
      position: relative;
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h1>
      <p class="subtitle">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù…ØªØ¬Ø±Ùƒ</p>
    </header>
    
    <div class="login-card">
      <div id="message" class="message"></div>
      
      <div class="form-group">
        <label for="email">
          <i class="fas fa-envelope"></i> Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
        </label>
        <input 
          type="email" 
          id="email" 
          placeholder="Ø§Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"
          autocomplete="email"
          required
        >
      </div>
      
      <div class="form-group">
        <label for="password">
          <i class="fas fa-lock"></i> ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        </label>
        <input 
          type="password" 
          id="password" 
          placeholder="Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
          autocomplete="current-password"
          required
        >
      </div>
      
      <button class="login-btn" id="loginBtn">
        <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
      </button>
      
      <div class="divider">
        <span>Ø£Ùˆ</span>
      </div>
      
      <button class="google-btn" id="googleBtn">
        <i class="fab fa-google"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Google
      </button>
    </div>
    
    <div class="links">
      <a href="register.html" class="link">
        <i class="fas fa-user-plus"></i> Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†
      </a>
    </div>
    
    <footer>
      <p>Ù†Ø¸Ø§Ù… DNRX - Ø§Ù„Ø¥ØµØ¯Ø§Ø± 1.0 | ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</p>
    </footer>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
    import { 
      getAuth, 
      signInWithEmailAndPassword,
      GoogleAuthProvider,
      signInWithPopup,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-auth.js";
    import { 
      getFirestore, 
      doc, 
      getDoc,
      setDoc,
      serverTimestamp 
    } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAG4EKrB3iLEV2hsB8b08ShpSO6PXDnGjg",
      authDomain: "zio3-8ffdd.firebaseapp.com",
      databaseURL: "https://zio3-8ffdd-default-rtdb.firebaseio.com",
      projectId: "zio3-8ffdd",
      storageBucket: "zio3-8ffdd.firebasestorage.app",
      messagingSenderId: "560939348415",
      appId: "1:560939348415:web:c854e9e214e498ad2d310a",
      measurementId: "G-CVN2B2D0RD"
    };
    
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    
    const ADMIN_EMAIL = 'ashlhl.iq@gmail.com';
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ù„Ø© Ù„Ù„Ø¯ÙˆØ§Ù„
    window.handleLogin = handleLogin;
    window.handleGoogleSignIn = handleGoogleSignIn;
    
    function showMessage(type, text) {
      const messageDiv = document.getElementById('message');
      messageDiv.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i> 
        ${text}
      `;
      messageDiv.className = `message ${type}`;
      messageDiv.style.display = 'block';
      
      if (type !== 'success') {
        setTimeout(() => {
          messageDiv.style.display = 'none';
        }, 5000);
      }
    }

    function validateInputs() {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        showMessage('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ­ÙŠØ­');
        return false;
      }
      
      if (!password) {
        showMessage('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
        return false;
      }
      
      return true;
    }

    function isProfileComplete(userData) {
      if (!userData) return false;
      
      const requiredFields = [
        'fullName',
        'birthDate',
        'phone',
        'storeName', 
        'storeType',
        'country',
        'city',
        'currency'
      ];
      
      for (const field of requiredFields) {
        if (!userData[field] || userData[field] === '') {
          return false;
        }
      }
      
      return true;
    }

    async function checkUserProfile(user) {
      try {
        const userDoc = await getDoc(doc(db, "dnrx_users", user.uid));
        
        if (userDoc.exists()) {
          const userData = userDoc.data();
          
          if (!userData.approved) {
            return 'pending_approval';
          }
          
          if (!isProfileComplete(userData)) {
            return 'profile_incomplete';
          }
          
          return {
            status: 'success',
            userType: userData.userType || 'user',
            userData: userData
          };
        } else {
          return 'user_not_found';
        }
      } catch (error) {
        console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ù„Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:", error);
        return 'error';
      }
    }

    async function handleLogin() {
      if (!validateInputs()) {
        return;
      }
      
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      
      const loginBtn = document.getElementById('loginBtn');
      const originalText = loginBtn.innerHTML;
      loginBtn.innerHTML = '<span class="spinner"></span> Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...';
      loginBtn.disabled = true;
      
      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        
        console.log("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:", user.uid);
        
        const profileCheck = await checkUserProfile(user);
        
        if (profileCheck === 'user_not_found') {
          showMessage('error', 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹');
          loginBtn.innerHTML = originalText;
          loginBtn.disabled = false;
          return;
        }
        
        if (profileCheck === 'pending_approval') {
          showMessage('info', 'Ø­Ø³Ø§Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø©');
          loginBtn.innerHTML = originalText;
          loginBtn.disabled = false;
          return;
        }
        
        if (profileCheck === 'profile_incomplete') {
          localStorage.setItem('dnrx_user', JSON.stringify({
            uid: user.uid,
            email: user.email
          }));
          
          showMessage('info', 'ÙŠØ¬Ø¨ Ø¥ÙƒÙ…Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ø£ÙˆÙ„Ø§Ù‹');
          setTimeout(() => {
            window.location.href = 'profile.html';
          }, 1500);
          return;
        }
        
        if (profileCheck.status === 'success') {
          const { userType, userData } = profileCheck;
          
          localStorage.setItem('dnrx_user', JSON.stringify({
            ...userData,
            uid: user.uid,
            email: user.email
          }));
          
          if (userType === 'admin') {
            showMessage('success', 'Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙŠØ§ Ø£Ø¯Ù…Ù†! ÙŠØªÙ… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡...');
            setTimeout(() => {
              window.location.href = 'admin.html';
            }, 1500);
          } else {
            showMessage('success', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­! ÙŠØªÙ… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Ù…ØªØ¬Ø±Ùƒ...');
            setTimeout(() => {
              window.location.href = 'main.html';
            }, 1500);
          }
        }
        
      } catch (error) {
        loginBtn.innerHTML = originalText;
        loginBtn.disabled = false;
        
        console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:", error);
        
        let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
        
        switch (error.code) {
          case 'auth/user-not-found':
            errorMessage = 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹';
            break;
          case 'auth/wrong-password':
            errorMessage = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
            break;
          case 'auth/invalid-email':
            errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­';
            break;
          case 'auth/user-disabled':
            errorMessage = 'ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨';
            break;
          case 'auth/too-many-requests':
            errorMessage = 'ØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙƒØ«ÙŠØ±Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹';
            break;
          default:
            errorMessage = `Ø®Ø·Ø£: ${error.message}`;
        }
        
        showMessage('error', errorMessage);
      }
    }

    async function handleGoogleSignIn() {
      const googleBtn = document.getElementById('googleBtn');
      const originalText = googleBtn.innerHTML;
      googleBtn.innerHTML = '<span class="spinner"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Google...';
      googleBtn.disabled = true;
      
      try {
        const provider = new GoogleAuthProvider();
        provider.setCustomParameters({
          prompt: 'select_account'
        });
        
        const result = await signInWithPopup(auth, provider);
        const user = result.user;
        
        console.log("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Google:", user.uid);
        
        const userRef = doc(db, "dnrx_users", user.uid);
        const userSnap = await getDoc(userRef);
        
        if (userSnap.exists()) {
          const userData = userSnap.data();
          
          if (!userData.approved) {
            showMessage('info', 'Ø­Ø³Ø§Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø©');
            googleBtn.innerHTML = originalText;
            googleBtn.disabled = false;
            return;
          }
          
          if (!isProfileComplete(userData)) {
            localStorage.setItem('dnrx_user', JSON.stringify({
              uid: user.uid,
              email: user.email
            }));
            
            showMessage('info', 'ÙŠØ¬Ø¨ Ø¥ÙƒÙ…Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ø£ÙˆÙ„Ø§Ù‹');
            setTimeout(() => {
              window.location.href = 'profile.html';
            }, 1500);
            return;
          }
          
          localStorage.setItem('dnrx_user', JSON.stringify({
            ...userData,
            uid: user.uid,
            email: user.email
          }));
          
          const isAdmin = user.email.toLowerCase() === ADMIN_EMAIL.toLowerCase();
          
          if (isAdmin) {
            showMessage('success', 'Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙŠØ§ Ø£Ø¯Ù…Ù†! ÙŠØªÙ… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡...');
            setTimeout(() => {
              window.location.href = 'admin.html';
            }, 1500);
          } else {
            showMessage('success', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­! ÙŠØªÙ… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡...');
            setTimeout(() => {
              window.location.href = 'main.html';
            }, 1500);
          }
          
        } else {
          const newUserData = {
            uid: user.uid,
            email: user.email,
            fullName: user.displayName || '',
            phone: '',
            birthDate: '',
            storeName: '',
            storeType: '',
            country: '',
            city: '',
            currency: '',
            userType: 'user',
            approved: true,
            profileComplete: false,
            loginMethod: 'google',
            googleId: user.uid,
            photoURL: user.photoURL || '',
            createdAt: serverTimestamp(),
            updatedAt: serverTimestamp()
          };
          
          await setDoc(userRef, newUserData);
          
          localStorage.setItem('dnrx_user', JSON.stringify({
            uid: user.uid,
            email: user.email
          }));
          
          showMessage('info', 'Ù…Ø±Ø­Ø¨Ø§Ù‹! ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠ');
          setTimeout(() => {
            window.location.href = 'profile.html';
          }, 1500);
        }
        
      } catch (error) {
        googleBtn.innerHTML = originalText;
        googleBtn.disabled = false;
        
        console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Google:", error);
        
        let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Google';
        
        switch (error.code) {
          case 'auth/popup-closed-by-user':
            errorMessage = 'ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
            break;
          case 'auth/popup-blocked':
            errorMessage = 'ØªÙ… Ø­Ø¸Ø± Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©';
            break;
          case 'auth/unauthorized-domain':
            errorMessage = 'Ù‡Ø°Ø§ Ø§Ù„Ù†Ø·Ø§Ù‚ ØºÙŠØ± Ù…ØµØ±Ø­ Ø¨Ù‡ Ù„Ù„ØªØ³Ø¬ÙŠÙ„ Ø¹Ø¨Ø± Google';
            break;
          default:
            errorMessage = `Ø®Ø·Ø£: ${error.message}`;
        }
        
        showMessage('error', errorMessage);
      }
    }

    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø²Ø±ÙŠÙ†
    document.getElementById('loginBtn').addEventListener('click', handleLogin);
    document.getElementById('googleBtn').addEventListener('click', handleGoogleSignIn);

    document.addEventListener('keypress', function(event) {
      if (event.key === 'Enter') {
        handleLogin();
      }
    });

    document.getElementById('email').addEventListener('input', function() {
      const email = this.value.trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      
      if (email && emailRegex.test(email)) {
        this.style.borderColor = '#2e7d32';
      } else if (email) {
        this.style.borderColor = '#c62828';
      } else {
        this.style.borderColor = '#ddd';
      }
    });

    onAuthStateChanged(auth, (user) => {
      if (user) {
        const savedUser = localStorage.getItem('dnrx_user');
        if (savedUser) {
          try {
            const userData = JSON.parse(savedUser);
            
            if (userData.email === user.email) {
              if (userData.userType === 'admin' || userData.storeId) {
                if (window.location.pathname.includes('login.html')) {
                  showMessage('info', 'Ø£Ù†Øª Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„ÙØ¹Ù„. ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡Ùƒ...');
                  
                  setTimeout(() => {
                    if (userData.userType === 'admin') {
                      window.location.href = 'admin.html';
                    } else {
                      window.location.href = 'main.html';
                    }
                  }, 1000);
                }
              }
            }
          } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù‚Ù‚ Ø§Ù„Ø¬Ù„Ø³Ø©:', error);
          }
        }
      }
    });

    window.addEventListener('load', () => {
      console.log('ğŸš€ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ DNRX Ø¬Ø§Ù‡Ø²Ø©');
    });
  </script>
</body>
</html>